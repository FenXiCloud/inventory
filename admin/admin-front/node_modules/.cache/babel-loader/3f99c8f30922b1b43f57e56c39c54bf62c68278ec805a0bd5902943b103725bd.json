{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  style: {\n    \"display\": \"flex\",\n    \"flex-direction\": \"column\",\n    \"height\": \"calc(100vh - 55px)\"\n  }\n};\nconst _hoisted_2 = {\n  class: \"flex-1\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_vxe_column = _resolveComponent(\"vxe-column\");\n  const _component_vxe_table = _resolveComponent(\"vxe-table\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_vxe_table, {\n    \"row-id\": \"id\",\n    height: \"auto\",\n    onCheckboxChange: $options.checkBoxChange,\n    onCheckboxAll: $options.checkBoxChange,\n    \"checkbox-config\": {\n      labelField: 'name',\n      checkMethod: $options.checkMethod,\n      checkRowKeys: $data.grantMenu\n    },\n    \"tree-config\": {\n      transform: true,\n      expandAll: true,\n      rowField: 'id',\n      parentField: 'parentId'\n    },\n    ref: \"table\",\n    data: $data.dataList,\n    \"highlight-hover-row\": \"\",\n    \"row-config\": {\n      useKey: true\n    },\n    stripe: false,\n    loading: $data.loading\n  }, {\n    default: _withCtx(() => [_createVNode(_component_vxe_column, {\n      title: \"菜单分组\",\n      width: \"100\",\n      align: \"center\",\n      field: \"menuGroup\",\n      formatter: ({\n        cellValue\n      }) => {\n        return {\n          MERCHANT: '集团菜单',\n          STORE: '门店菜单'\n        }[cellValue];\n      }\n    }, null, 8 /* PROPS */, [\"formatter\"]), _createVNode(_component_vxe_column, {\n      type: \"checkbox\",\n      title: \"名称\",\n      field: \"name\",\n      \"tree-node\": \"\"\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onCheckboxChange\", \"onCheckboxAll\", \"checkbox-config\", \"data\", \"loading\"])])]);\n}","map":{"version":3,"names":["style","class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_vxe_table","height","onCheckboxChange","$options","checkBoxChange","onCheckboxAll","labelField","checkMethod","checkRowKeys","$data","grantMenu","transform","expandAll","rowField","parentField","ref","data","dataList","useKey","stripe","loading","default","_withCtx","_component_vxe_column","title","width","align","field","formatter","cellValue","MERCHANT","STORE","type","_"],"sources":["D:\\DevWorks\\jxc\\admin\\admin-front\\src\\components\\merchant\\role\\GrantMenu.vue"],"sourcesContent":["<template>\r\n  <div style=\"display: flex;flex-direction: column;height: calc(100vh - 55px)\">\r\n    <div class=\"flex-1\">\r\n      <vxe-table row-id=\"id\"\r\n                 height=\"auto\"\r\n                 @checkbox-change=\"checkBoxChange\"\r\n                 @checkbox-all=\"checkBoxChange\"\r\n                 :checkbox-config=\"{labelField: 'name',checkMethod:checkMethod,checkRowKeys:grantMenu}\"\r\n                 :tree-config=\"{transform:true, expandAll:true, rowField: 'id', parentField: 'parentId'}\"\r\n                 ref=\"table\"\r\n                 :data=\"dataList\"\r\n                 highlight-hover-row\r\n                 :row-config=\"{useKey:true}\"\r\n                 :stripe=\"false\"\r\n                 :loading=\"loading\">\r\n        <vxe-column title=\"菜单分组\" width=\"100\" align=\"center\" field=\"menuGroup\" :formatter=\"({ cellValue })=>{return {MERCHANT:'集团菜单',STORE:'门店菜单'}[cellValue]}\"/>\r\n        <vxe-column type=\"checkbox\" title=\"名称\" field=\"name\" tree-node/>\r\n      </vxe-table>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Role from \"@js/api/Role\";\r\nimport {message} from \"heyui.ext\";\r\nimport Menu from \"@js/api/Menu\";\r\n\r\n/**\r\n * @功能描述: 角色授权\r\n * @创建时间: 2023年08月08日\r\n * @公司官网: www.fenxi365.com\r\n * @公司信息: 纷析云（杭州）科技有限公司\r\n * @公司介绍: 专注于财务相关软件开发, 企业会计自动化解决方案\r\n */\r\nexport default {\r\n  name: \"GrantMenu\",\r\n  props: {\r\n    entity: Object,\r\n    merchant: Object,\r\n  },\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      dataList: [],\r\n      grantMenu: [],\r\n    }\r\n  },\r\n  methods: {\r\n    checkBoxChange({records}) {\r\n      this.loading = true;\r\n      let indeterminateRecords = this.$refs.table.getCheckboxIndeterminateRecords().map(val => val.id);\r\n      let merchantMenu = records.map(val => val.id).concat(indeterminateRecords)\r\n\r\n      this.loading = true;\r\n      Role.roleGrant(this.entity.id, merchantMenu).then(() => {\r\n        message(\"授权成功~\");\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    loadData() {\r\n      this.loading = true;\r\n      Promise.all([\r\n        Menu.merchantMenu(this.merchant.id),\r\n        Role.getMenuRole(this.entity.id)\r\n      ]).then((results) => {\r\n        this.dataList = results[0].data || [];\r\n        this.grantMenu = this.dataList.filter(val => !val.requireAuth).map(val => val.id);\r\n\r\n        this.$nextTick(() => {\r\n          if (results[1].data) {\r\n            results[1].data.forEach(id => {\r\n              let rowById = this.$refs.table.getRowById(id);\r\n              if (!rowById.children || !rowById.children.length) {\r\n                this.$refs.table.setCheckboxRow(rowById, true);\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    checkMethod({row}) {\r\n      return row.requireAuth;\r\n    }\r\n  },\r\n  created() {\r\n    this.loadData();\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.m-cus-menu {\r\n  height: calc(100vh - 150px);\r\n  overflow: hidden;\r\n}\r\n</style>\r\n"],"mappings":";;EACOA,KAAuE,EAAvE;IAAA;IAAA;IAAA;EAAA;AAAuE;;EACrEC,KAAK,EAAC;AAAQ;;;;uBADrBC,mBAAA,CAkBM,OAlBNC,UAkBM,GAjBJC,mBAAA,CAgBM,OAhBNC,UAgBM,GAfJC,YAAA,CAcYC,oBAAA;IAdD,QAAM,EAAC,IAAI;IACXC,MAAM,EAAC,MAAM;IACZC,gBAAe,EAAEC,QAAA,CAAAC,cAAc;IAC/BC,aAAY,EAAEF,QAAA,CAAAC,cAAc;IAC5B,iBAAe;MAAAE,UAAA;MAAAC,WAAA,EAAkCJ,QAAA,CAAAI,WAAW;MAAAC,YAAA,EAAcC,KAAA,CAAAC;IAAS;IACnF,aAAW,EAAE;MAAAC,SAAA;MAAAC,SAAA;MAAAC,QAAA;MAAAC,WAAA;IAAA,CAAyE;IACvFC,GAAG,EAAC,OAAO;IACVC,IAAI,EAAEP,KAAA,CAAAQ,QAAQ;IACf,qBAAmB,EAAnB,EAAmB;IAClB,YAAU,EAAE;MAAAC,MAAA;IAAA,CAAa;IACzBC,MAAM,EAAE,KAAK;IACbC,OAAO,EAAEX,KAAA,CAAAW;;IAd3BC,OAAA,EAAAC,QAAA,CAeQ,MAAwJ,CAAxJvB,YAAA,CAAwJwB,qBAAA;MAA5IC,KAAK,EAAC,MAAM;MAACC,KAAK,EAAC,KAAK;MAACC,KAAK,EAAC,QAAQ;MAACC,KAAK,EAAC,WAAW;MAAEC,SAAS,EAAAA,CAAA;QAAKC;MAAS;QAAA;UAAAC,QAAA;UAAAC,KAAA;QAAA,EAA4CF,SAAS;MAAA;4CACnJ9B,YAAA,CAA+DwB,qBAAA;MAAnDS,IAAI,EAAC,UAAU;MAACR,KAAK,EAAC,IAAI;MAACG,KAAK,EAAC,MAAM;MAAC,WAAS,EAAT;;IAhB5DM,CAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}