{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_vxe_column = _resolveComponent(\"vxe-column\");\n  const _component_vxe_table = _resolveComponent(\"vxe-table\");\n  return _openBlock(), _createBlock(_component_vxe_table, {\n    \"row-id\": \"id\",\n    height: \"auto\",\n    onCheckboxChange: $options.checkBoxChange,\n    onCheckboxAll: $options.checkBoxChange,\n    \"checkbox-config\": {\n      labelField: 'name',\n      checkMethod: $options.checkMethod,\n      checkRowKeys: $data.grantMenu\n    },\n    \"tree-config\": {\n      transform: true,\n      expandAll: true,\n      rowField: 'id',\n      parentField: 'parentId'\n    },\n    ref: \"table\",\n    data: $data.dataList,\n    \"highlight-hover-row\": \"\",\n    \"row-config\": {\n      useKey: true\n    },\n    stripe: false,\n    loading: $data.loading\n  }, {\n    default: _withCtx(() => [_createVNode(_component_vxe_column, {\n      title: \"菜单模块\",\n      width: \"100\",\n      align: \"center\",\n      field: \"menuModule\",\n      formatter: ({\n        cellValue\n      }) => {\n        return {\n          MERCHANT: '集团视角',\n          CUSTOM: '客户视角',\n          SUPPLIER: '货商视角'\n        }[cellValue];\n      }\n    }, null, 8 /* PROPS */, [\"formatter\"]), _createVNode(_component_vxe_column, {\n      title: \"菜单分组\",\n      width: \"100\",\n      align: \"center\",\n      field: \"menuGroup\",\n      formatter: ({\n        cellValue\n      }) => {\n        return {\n          MERCHANT: '集团菜单',\n          STORE: '门店菜单'\n        }[cellValue];\n      }\n    }, null, 8 /* PROPS */, [\"formatter\"]), _createVNode(_component_vxe_column, {\n      type: \"checkbox\",\n      title: \"名称\",\n      field: \"name\",\n      \"tree-node\": \"\"\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onCheckboxChange\", \"onCheckboxAll\", \"checkbox-config\", \"data\", \"loading\"]);\n}","map":{"version":3,"names":["_createBlock","_component_vxe_table","height","onCheckboxChange","$options","checkBoxChange","onCheckboxAll","labelField","checkMethod","checkRowKeys","$data","grantMenu","transform","expandAll","rowField","parentField","ref","data","dataList","useKey","stripe","loading","default","_withCtx","_createVNode","_component_vxe_column","title","width","align","field","formatter","cellValue","MERCHANT","CUSTOM","SUPPLIER","STORE","type","_"],"sources":["D:\\DevWorks\\jxc\\admin\\admin-front\\src\\components\\merchant\\MerchantModuleGrant.vue"],"sourcesContent":["<template>\r\n  <vxe-table row-id=\"id\"\r\n             height=\"auto\"\r\n             @checkbox-change=\"checkBoxChange\"\r\n             @checkbox-all=\"checkBoxChange\"\r\n             :checkbox-config=\"{labelField: 'name',checkMethod:checkMethod, checkRowKeys: grantMenu}\"\r\n             :tree-config=\"{transform:true,expandAll:true,rowField: 'id', parentField: 'parentId'}\"\r\n             ref=\"table\"\r\n             :data=\"dataList\"\r\n             highlight-hover-row\r\n             :row-config=\"{useKey:true}\"\r\n             :stripe=\"false\"\r\n             :loading=\"loading\">\r\n    <vxe-column title=\"菜单模块\" width=\"100\" align=\"center\" field=\"menuModule\" :formatter=\"({ cellValue })=>{return {MERCHANT:'集团视角',CUSTOM:'客户视角',SUPPLIER:'货商视角'}[cellValue]}\"/>\r\n    <vxe-column title=\"菜单分组\" width=\"100\" align=\"center\" field=\"menuGroup\" :formatter=\"({ cellValue })=>{return {MERCHANT:'集团菜单',STORE:'门店菜单'}[cellValue]}\"/>\r\n    <vxe-column type=\"checkbox\" title=\"名称\" field=\"name\" tree-node/>\r\n  </vxe-table>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * <p>****************************************************************************</p>\r\n * <p><b>Copyright © 2010-2022 soho team All Rights Reserved<b></p>\r\n * <ul style=\"margin:15px;\">\r\n * <li>Description : </li>\r\n * <li>Version     : 1.0</li>\r\n * <li>Creation    : 2022年03月11日</li>\r\n * <li>@author     : ____′↘夏悸</li>\r\n * </ul>\r\n * <p>****************************************************************************</p>\r\n */\r\nimport Menu from \"@js/api/Menu\";\r\nimport {message} from \"heyui.ext\";\r\n\r\nexport default {\r\n  name: \"MerchantModuleGrant\",\r\n  props: {\r\n    merchant: Object,\r\n  },\r\n  data() {\r\n    return {\r\n      showForm: false,\r\n      grantMerchantForm: false,\r\n      loading: false,\r\n      grantMenu: [],\r\n      checkBoxList: [],\r\n      params: {\r\n        enabled: true,\r\n      },\r\n      checkedRows: [],\r\n      dataList: [],\r\n    }\r\n  },\r\n  watch: {\r\n    'params.merchantId'() {\r\n      this.loadList();\r\n    }\r\n  },\r\n  methods: {\r\n    checkBoxChange({records}) {\r\n      this.checkRequire();\r\n      this.loading = true;\r\n      let indeterminateRecords = this.$refs.table.getCheckboxIndeterminateRecords().map(val => val.id);\r\n      let menus = this.$refs.table.getCheckboxRecords().map(val => val.id).concat(indeterminateRecords);\r\n      let merchantMenu = {menus: menus, merchants: [this.merchant.id]};\r\n\r\n      Menu.grantMerchant(merchantMenu).then(() => {\r\n        message(\"授权成功~\");\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    checkRequire() {\r\n      this.grantMenu.forEach(id => {\r\n        let rowById = this.$refs.table.getRowById(id);\r\n        if (!rowById.children || !rowById.children.length) {\r\n          this.$refs.table.setCheckboxRow(rowById, true);\r\n        }\r\n      })\r\n    },\r\n    loadList() {\r\n      this.loading = true;\r\n      Promise.all([\r\n        Menu.list(this.params),\r\n        Menu.queryGrantMenu(this.merchant.id)\r\n      ]).then((results) => {\r\n        this.dataList = results[0].data\r\n        this.grantMenu = this.dataList.filter(val => !val.requireAuth).map(val => val.id);\r\n\r\n        this.$nextTick(() => {\r\n          if (results[1].data) {\r\n            results[1].data.forEach(id => {\r\n              let rowById = this.$refs.table.getRowById(id);\r\n              if (!rowById.children || !rowById.children.length) {\r\n                this.$refs.table.setCheckboxRow(rowById, true);\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    checkMethod({row}) {\r\n      return row.requireAuth;\r\n    }\r\n  },\r\n  created() {\r\n    this.loadList();\r\n  }\r\n}\r\n</script>\r\n"],"mappings":";;;;uBACEA,YAAA,CAeYC,oBAAA;IAfD,QAAM,EAAC,IAAI;IACXC,MAAM,EAAC,MAAM;IACZC,gBAAe,EAAEC,QAAA,CAAAC,cAAc;IAC/BC,aAAY,EAAEF,QAAA,CAAAC,cAAc;IAC5B,iBAAe;MAAAE,UAAA;MAAAC,WAAA,EAAkCJ,QAAA,CAAAI,WAAW;MAAAC,YAAA,EAAgBC,KAAA,CAAAC;IAAS;IACrF,aAAW,EAAE;MAAAC,SAAA;MAAAC,SAAA;MAAAC,QAAA;MAAAC,WAAA;IAAA,CAAuE;IACrFC,GAAG,EAAC,OAAO;IACVC,IAAI,EAAEP,KAAA,CAAAQ,QAAQ;IACf,qBAAmB,EAAnB,EAAmB;IAClB,YAAU,EAAE;MAAAC,MAAA;IAAA,CAAa;IACzBC,MAAM,EAAE,KAAK;IACbC,OAAO,EAAEX,KAAA,CAAAW;;IAZvBC,OAAA,EAAAC,QAAA,CAaI,MAA0K,CAA1KC,YAAA,CAA0KC,qBAAA;MAA9JC,KAAK,EAAC,MAAM;MAACC,KAAK,EAAC,KAAK;MAACC,KAAK,EAAC,QAAQ;MAACC,KAAK,EAAC,YAAY;MAAEC,SAAS,EAAAA,CAAA;QAAKC;MAAS;QAAA;UAAAC,QAAA;UAAAC,MAAA;UAAAC,QAAA;QAAA,EAA6DH,SAAS;MAAA;4CACrKP,YAAA,CAAwJC,qBAAA;MAA5IC,KAAK,EAAC,MAAM;MAACC,KAAK,EAAC,KAAK;MAACC,KAAK,EAAC,QAAQ;MAACC,KAAK,EAAC,WAAW;MAAEC,SAAS,EAAAA,CAAA;QAAKC;MAAS;QAAA;UAAAC,QAAA;UAAAG,KAAA;QAAA,EAA4CJ,SAAS;MAAA;4CACnJP,YAAA,CAA+DC,qBAAA;MAAnDW,IAAI,EAAC,UAAU;MAACV,KAAK,EAAC,IAAI;MAACG,KAAK,EAAC,MAAM;MAAC,WAAS,EAAT;;IAfxDQ,CAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}