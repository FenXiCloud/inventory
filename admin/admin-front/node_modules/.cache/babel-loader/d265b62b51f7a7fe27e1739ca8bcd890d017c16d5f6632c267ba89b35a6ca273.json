{"ast":null,"code":"import \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\n/**\r\n * <p>****************************************************************************</p>\r\n * <p><b>Copyright © 2010-2022 soho team All Rights Reserved<b></p>\r\n * <ul style=\"margin:15px;\">\r\n * <li>Description : </li>\r\n * <li>Version     : 1.0</li>\r\n * <li>Creation    : 2022年03月11日</li>\r\n * <li>@author     : ____′↘夏悸</li>\r\n * </ul>\r\n * <p>****************************************************************************</p>\r\n */\nimport Menu from \"@js/api/Menu\";\nimport { message } from \"heyui.ext\";\nexport default {\n  name: \"MerchantModuleGrant\",\n  props: {\n    merchant: Object\n  },\n  data() {\n    return {\n      showForm: false,\n      grantMerchantForm: false,\n      loading: false,\n      grantMenu: [],\n      checkBoxList: [],\n      params: {\n        enabled: true\n      },\n      checkedRows: [],\n      dataList: []\n    };\n  },\n  watch: {\n    'params.merchantId'() {\n      this.loadList();\n    }\n  },\n  methods: {\n    checkBoxChange({\n      records\n    }) {\n      this.checkRequire();\n      this.loading = true;\n      let indeterminateRecords = this.$refs.table.getCheckboxIndeterminateRecords().map(val => val.id);\n      let menus = this.$refs.table.getCheckboxRecords().map(val => val.id).concat(indeterminateRecords);\n      let merchantMenu = {\n        menus: menus,\n        merchants: [this.merchant.id]\n      };\n      Menu.grantMerchant(merchantMenu).then(() => {\n        message(\"授权成功~\");\n      }).finally(() => this.loading = false);\n    },\n    checkRequire() {\n      this.grantMenu.forEach(id => {\n        let rowById = this.$refs.table.getRowById(id);\n        if (!rowById.children || !rowById.children.length) {\n          this.$refs.table.setCheckboxRow(rowById, true);\n        }\n      });\n    },\n    loadList() {\n      this.loading = true;\n      Promise.all([Menu.list(this.params), Menu.queryGrantMenu(this.merchant.id)]).then(results => {\n        this.dataList = results[0].data;\n        this.grantMenu = this.dataList.filter(val => !val.requireAuth).map(val => val.id);\n        this.$nextTick(() => {\n          if (results[1].data) {\n            results[1].data.forEach(id => {\n              let rowById = this.$refs.table.getRowById(id);\n              if (!rowById.children || !rowById.children.length) {\n                this.$refs.table.setCheckboxRow(rowById, true);\n              }\n            });\n          }\n        });\n      }).finally(() => this.loading = false);\n    },\n    checkMethod({\n      row\n    }) {\n      return row.requireAuth;\n    }\n  },\n  created() {\n    this.loadList();\n  }\n};","map":{"version":3,"names":["Menu","message","name","props","merchant","Object","data","showForm","grantMerchantForm","loading","grantMenu","checkBoxList","params","enabled","checkedRows","dataList","watch","params.merchantId","loadList","methods","checkBoxChange","records","checkRequire","indeterminateRecords","$refs","table","getCheckboxIndeterminateRecords","map","val","id","menus","getCheckboxRecords","concat","merchantMenu","merchants","grantMerchant","then","finally","forEach","rowById","getRowById","children","length","setCheckboxRow","Promise","all","list","queryGrantMenu","results","filter","requireAuth","$nextTick","checkMethod","row","created"],"sources":["D:\\DevWorks\\jxc\\admin\\admin-front\\src\\components\\merchant\\MerchantModuleGrant.vue"],"sourcesContent":["<template>\r\n  <vxe-table row-id=\"id\"\r\n             height=\"auto\"\r\n             @checkbox-change=\"checkBoxChange\"\r\n             @checkbox-all=\"checkBoxChange\"\r\n             :checkbox-config=\"{labelField: 'name',checkMethod:checkMethod, checkRowKeys: grantMenu}\"\r\n             :tree-config=\"{transform:true,expandAll:true,rowField: 'id', parentField: 'parentId'}\"\r\n             ref=\"table\"\r\n             :data=\"dataList\"\r\n             highlight-hover-row\r\n             :row-config=\"{useKey:true}\"\r\n             :stripe=\"false\"\r\n             :loading=\"loading\">\r\n    <vxe-column title=\"菜单模块\" width=\"100\" align=\"center\" field=\"menuModule\" :formatter=\"({ cellValue })=>{return {MERCHANT:'集团视角',CUSTOM:'客户视角',SUPPLIER:'货商视角'}[cellValue]}\"/>\r\n    <vxe-column title=\"菜单分组\" width=\"100\" align=\"center\" field=\"menuGroup\" :formatter=\"({ cellValue })=>{return {MERCHANT:'集团菜单',STORE:'门店菜单'}[cellValue]}\"/>\r\n    <vxe-column type=\"checkbox\" title=\"名称\" field=\"name\" tree-node/>\r\n  </vxe-table>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * <p>****************************************************************************</p>\r\n * <p><b>Copyright © 2010-2022 soho team All Rights Reserved<b></p>\r\n * <ul style=\"margin:15px;\">\r\n * <li>Description : </li>\r\n * <li>Version     : 1.0</li>\r\n * <li>Creation    : 2022年03月11日</li>\r\n * <li>@author     : ____′↘夏悸</li>\r\n * </ul>\r\n * <p>****************************************************************************</p>\r\n */\r\nimport Menu from \"@js/api/Menu\";\r\nimport {message} from \"heyui.ext\";\r\n\r\nexport default {\r\n  name: \"MerchantModuleGrant\",\r\n  props: {\r\n    merchant: Object,\r\n  },\r\n  data() {\r\n    return {\r\n      showForm: false,\r\n      grantMerchantForm: false,\r\n      loading: false,\r\n      grantMenu: [],\r\n      checkBoxList: [],\r\n      params: {\r\n        enabled: true,\r\n      },\r\n      checkedRows: [],\r\n      dataList: [],\r\n    }\r\n  },\r\n  watch: {\r\n    'params.merchantId'() {\r\n      this.loadList();\r\n    }\r\n  },\r\n  methods: {\r\n    checkBoxChange({records}) {\r\n      this.checkRequire();\r\n      this.loading = true;\r\n      let indeterminateRecords = this.$refs.table.getCheckboxIndeterminateRecords().map(val => val.id);\r\n      let menus = this.$refs.table.getCheckboxRecords().map(val => val.id).concat(indeterminateRecords);\r\n      let merchantMenu = {menus: menus, merchants: [this.merchant.id]};\r\n\r\n      Menu.grantMerchant(merchantMenu).then(() => {\r\n        message(\"授权成功~\");\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    checkRequire() {\r\n      this.grantMenu.forEach(id => {\r\n        let rowById = this.$refs.table.getRowById(id);\r\n        if (!rowById.children || !rowById.children.length) {\r\n          this.$refs.table.setCheckboxRow(rowById, true);\r\n        }\r\n      })\r\n    },\r\n    loadList() {\r\n      this.loading = true;\r\n      Promise.all([\r\n        Menu.list(this.params),\r\n        Menu.queryGrantMenu(this.merchant.id)\r\n      ]).then((results) => {\r\n        this.dataList = results[0].data\r\n        this.grantMenu = this.dataList.filter(val => !val.requireAuth).map(val => val.id);\r\n\r\n        this.$nextTick(() => {\r\n          if (results[1].data) {\r\n            results[1].data.forEach(id => {\r\n              let rowById = this.$refs.table.getRowById(id);\r\n              if (!rowById.children || !rowById.children.length) {\r\n                this.$refs.table.setCheckboxRow(rowById, true);\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    checkMethod({row}) {\r\n      return row.requireAuth;\r\n    }\r\n  },\r\n  created() {\r\n    this.loadList();\r\n  }\r\n}\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}