{"ast":null,"code":"import \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport Role from \"@js/api/Role\";\nimport { message } from \"heyui.ext\";\nimport Menu from \"@js/api/Menu\";\n\n/**\r\n * @功能描述: 角色授权\r\n * @创建时间: 2023年08月08日\r\n * @公司官网: www.fenxi365.com\r\n * @公司信息: 纷析云（杭州）科技有限公司\r\n * @公司介绍: 专注于财务相关软件开发, 企业会计自动化解决方案\r\n */\nexport default {\n  name: \"GrantMenu\",\n  props: {\n    entity: Object,\n    merchant: Object\n  },\n  data() {\n    return {\n      loading: false,\n      dataList: [],\n      grantMenu: []\n    };\n  },\n  methods: {\n    checkBoxChange({\n      records\n    }) {\n      this.loading = true;\n      let indeterminateRecords = this.$refs.table.getCheckboxIndeterminateRecords().map(val => val.id);\n      let merchantMenu = records.map(val => val.id).concat(indeterminateRecords);\n      this.loading = true;\n      Role.roleGrant(this.entity.id, merchantMenu).then(() => {\n        message(\"授权成功~\");\n      }).finally(() => this.loading = false);\n    },\n    loadData() {\n      this.loading = true;\n      Promise.all([Menu.merchantMenu(this.merchant.id), Role.getMenuRole(this.entity.id)]).then(results => {\n        this.dataList = results[0].data || [];\n        this.grantMenu = this.dataList.filter(val => !val.requireAuth).map(val => val.id);\n        this.$nextTick(() => {\n          if (results[1].data) {\n            results[1].data.forEach(id => {\n              let rowById = this.$refs.table.getRowById(id);\n              if (!rowById.children || !rowById.children.length) {\n                this.$refs.table.setCheckboxRow(rowById, true);\n              }\n            });\n          }\n        });\n      }).finally(() => this.loading = false);\n    },\n    checkMethod({\n      row\n    }) {\n      return row.requireAuth;\n    }\n  },\n  created() {\n    this.loadData();\n  }\n};","map":{"version":3,"names":["Role","message","Menu","name","props","entity","Object","merchant","data","loading","dataList","grantMenu","methods","checkBoxChange","records","indeterminateRecords","$refs","table","getCheckboxIndeterminateRecords","map","val","id","merchantMenu","concat","roleGrant","then","finally","loadData","Promise","all","getMenuRole","results","filter","requireAuth","$nextTick","forEach","rowById","getRowById","children","length","setCheckboxRow","checkMethod","row","created"],"sources":["D:\\DevWorks\\jxc\\admin\\admin-front\\src\\components\\merchant\\role\\GrantMenu.vue"],"sourcesContent":["<template>\r\n  <div style=\"display: flex;flex-direction: column;height: calc(100vh - 55px)\">\r\n    <div class=\"flex-1\">\r\n      <vxe-table row-id=\"id\"\r\n                 height=\"auto\"\r\n                 @checkbox-change=\"checkBoxChange\"\r\n                 @checkbox-all=\"checkBoxChange\"\r\n                 :checkbox-config=\"{labelField: 'name',checkMethod:checkMethod,checkRowKeys:grantMenu}\"\r\n                 :tree-config=\"{transform:true, expandAll:true, rowField: 'id', parentField: 'parentId'}\"\r\n                 ref=\"table\"\r\n                 :data=\"dataList\"\r\n                 highlight-hover-row\r\n                 :row-config=\"{useKey:true}\"\r\n                 :stripe=\"false\"\r\n                 :loading=\"loading\">\r\n        <vxe-column title=\"菜单分组\" width=\"100\" align=\"center\" field=\"menuGroup\" :formatter=\"({ cellValue })=>{return {MERCHANT:'集团菜单',STORE:'门店菜单'}[cellValue]}\"/>\r\n        <vxe-column type=\"checkbox\" title=\"名称\" field=\"name\" tree-node/>\r\n      </vxe-table>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Role from \"@js/api/Role\";\r\nimport {message} from \"heyui.ext\";\r\nimport Menu from \"@js/api/Menu\";\r\n\r\n/**\r\n * @功能描述: 角色授权\r\n * @创建时间: 2023年08月08日\r\n * @公司官网: www.fenxi365.com\r\n * @公司信息: 纷析云（杭州）科技有限公司\r\n * @公司介绍: 专注于财务相关软件开发, 企业会计自动化解决方案\r\n */\r\nexport default {\r\n  name: \"GrantMenu\",\r\n  props: {\r\n    entity: Object,\r\n    merchant: Object,\r\n  },\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      dataList: [],\r\n      grantMenu: [],\r\n    }\r\n  },\r\n  methods: {\r\n    checkBoxChange({records}) {\r\n      this.loading = true;\r\n      let indeterminateRecords = this.$refs.table.getCheckboxIndeterminateRecords().map(val => val.id);\r\n      let merchantMenu = records.map(val => val.id).concat(indeterminateRecords)\r\n\r\n      this.loading = true;\r\n      Role.roleGrant(this.entity.id, merchantMenu).then(() => {\r\n        message(\"授权成功~\");\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    loadData() {\r\n      this.loading = true;\r\n      Promise.all([\r\n        Menu.merchantMenu(this.merchant.id),\r\n        Role.getMenuRole(this.entity.id)\r\n      ]).then((results) => {\r\n        this.dataList = results[0].data || [];\r\n        this.grantMenu = this.dataList.filter(val => !val.requireAuth).map(val => val.id);\r\n\r\n        this.$nextTick(() => {\r\n          if (results[1].data) {\r\n            results[1].data.forEach(id => {\r\n              let rowById = this.$refs.table.getRowById(id);\r\n              if (!rowById.children || !rowById.children.length) {\r\n                this.$refs.table.setCheckboxRow(rowById, true);\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    checkMethod({row}) {\r\n      return row.requireAuth;\r\n    }\r\n  },\r\n  created() {\r\n    this.loadData();\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.m-cus-menu {\r\n  height: calc(100vh - 150px);\r\n  overflow: hidden;\r\n}\r\n</style>\r\n"],"mappings":";;;;AAuBA,OAAOA,IAAG,MAAO,cAAc;AAC/B,SAAQC,OAAO,QAAO,WAAW;AACjC,OAAOC,IAAG,MAAO,cAAc;;AAE/B;;;;;;;AAOA,eAAe;EACbC,IAAI,EAAE,WAAW;EACjBC,KAAK,EAAE;IACLC,MAAM,EAAEC,MAAM;IACdC,QAAQ,EAAED;EACZ,CAAC;EACDE,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,OAAO,EAAE,KAAK;MACdC,QAAQ,EAAE,EAAE;MACZC,SAAS,EAAE;IACb;EACF,CAAC;EACDC,OAAO,EAAE;IACPC,cAAcA,CAAC;MAACC;IAAO,CAAC,EAAE;MACxB,IAAI,CAACL,OAAM,GAAI,IAAI;MACnB,IAAIM,oBAAmB,GAAI,IAAI,CAACC,KAAK,CAACC,KAAK,CAACC,+BAA+B,CAAC,CAAC,CAACC,GAAG,CAACC,GAAE,IAAKA,GAAG,CAACC,EAAE,CAAC;MAChG,IAAIC,YAAW,GAAIR,OAAO,CAACK,GAAG,CAACC,GAAE,IAAKA,GAAG,CAACC,EAAE,CAAC,CAACE,MAAM,CAACR,oBAAoB;MAEzE,IAAI,CAACN,OAAM,GAAI,IAAI;MACnBT,IAAI,CAACwB,SAAS,CAAC,IAAI,CAACnB,MAAM,CAACgB,EAAE,EAAEC,YAAY,CAAC,CAACG,IAAI,CAAC,MAAM;QACtDxB,OAAO,CAAC,OAAO,CAAC;MAClB,CAAC,CAAC,CAACyB,OAAO,CAAC,MAAM,IAAI,CAACjB,OAAM,GAAI,KAAK,CAAC;IACxC,CAAC;IACDkB,QAAQA,CAAA,EAAG;MACT,IAAI,CAAClB,OAAM,GAAI,IAAI;MACnBmB,OAAO,CAACC,GAAG,CAAC,CACV3B,IAAI,CAACoB,YAAY,CAAC,IAAI,CAACf,QAAQ,CAACc,EAAE,CAAC,EACnCrB,IAAI,CAAC8B,WAAW,CAAC,IAAI,CAACzB,MAAM,CAACgB,EAAE,EAChC,CAAC,CAACI,IAAI,CAAEM,OAAO,IAAK;QACnB,IAAI,CAACrB,QAAO,GAAIqB,OAAO,CAAC,CAAC,CAAC,CAACvB,IAAG,IAAK,EAAE;QACrC,IAAI,CAACG,SAAQ,GAAI,IAAI,CAACD,QAAQ,CAACsB,MAAM,CAACZ,GAAE,IAAK,CAACA,GAAG,CAACa,WAAW,CAAC,CAACd,GAAG,CAACC,GAAE,IAAKA,GAAG,CAACC,EAAE,CAAC;QAEjF,IAAI,CAACa,SAAS,CAAC,MAAM;UACnB,IAAIH,OAAO,CAAC,CAAC,CAAC,CAACvB,IAAI,EAAE;YACnBuB,OAAO,CAAC,CAAC,CAAC,CAACvB,IAAI,CAAC2B,OAAO,CAACd,EAAC,IAAK;cAC5B,IAAIe,OAAM,GAAI,IAAI,CAACpB,KAAK,CAACC,KAAK,CAACoB,UAAU,CAAChB,EAAE,CAAC;cAC7C,IAAI,CAACe,OAAO,CAACE,QAAO,IAAK,CAACF,OAAO,CAACE,QAAQ,CAACC,MAAM,EAAE;gBACjD,IAAI,CAACvB,KAAK,CAACC,KAAK,CAACuB,cAAc,CAACJ,OAAO,EAAE,IAAI,CAAC;cAChD;YACF,CAAC;UACH;QACF,CAAC;MACH,CAAC,CAAC,CAACV,OAAO,CAAC,MAAM,IAAI,CAACjB,OAAM,GAAI,KAAK,CAAC;IACxC,CAAC;IACDgC,WAAWA,CAAC;MAACC;IAAG,CAAC,EAAE;MACjB,OAAOA,GAAG,CAACT,WAAW;IACxB;EACF,CAAC;EACDU,OAAOA,CAAA,EAAG;IACR,IAAI,CAAChB,QAAQ,CAAC,CAAC;EACjB;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}