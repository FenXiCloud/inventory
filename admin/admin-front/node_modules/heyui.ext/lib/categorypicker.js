var x=Object.defineProperty;var j=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var v=(e,t,s)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,C=(e,t)=>{for(var s in t||(t={}))N.call(t,s)&&v(e,s,t[s]);if(j)for(var s of j(t))P.call(t,s)&&v(e,s,t[s]);return e};import k from"./utils/config.js";import{u as a}from"./utils.js";import T from"./plugins/dropdown.js";import O from"./mixins/locale.js";import S from"./plugins/message.js";import{C as B}from"./checkbox.js";import{resolveComponent as w,openBlock as r,createElementBlock as h,normalizeClass as y,createElementVNode as d,Fragment as D,renderList as V,toDisplayString as g,withModifiers as _,createCommentVNode as b,createVNode as M,createBlock as K,createTextVNode as E}from"vue";import{_ as F}from"./_plugin-vue_export-helper.js";const u="h-categorypicker",p="-------",A={name:"HCategoryPicker",components:{Checkbox:B},mixins:[O],emits:["update:modelValue","input","update","clear","loadDataSuccess","change"],props:{option:Object,multiple:{type:Boolean,default:!1},type:{type:[String],default:"key"},disabled:{type:Boolean,default:!1},limit:Number,placeholder:{type:String},filterable:{type:Boolean,default:!0},showAllLevels:{type:Boolean,default:!0},showChildCount:{type:Boolean,default:!1},modelValue:[Number,String,Array,Object],config:String,className:String},data(){return{dropdown:null,globalloading:!1,loading:!0,objects:[],object:null,tabs:[{title:this.hlang("h.categoryModal.total"),key:p}],tab:p,categoryDatas:[],categoryObj:{},searchValue:null,tabIndex:0,list:[],valueBak:null}},computed:{showPlaceholder(){return this.placeholder||this.hlang("h.categoryPicker.placeholder")},param(){return this.config?a.extend({},k.getOption("categoryPicker.default"),k.getOption(`categoryPicker.configs.${this.config}`),this.option):a.extend({},k.getOption("categoryPicker.default"),this.option)},categoryCls(){return{[`${u}`]:!0,[`${u}-input-border`]:!0,[`${u}-no-autosize`]:!0,[`${u}-multiple`]:this.multiple,[`${u}-disabled`]:this.disabled}},groupCls(){return{[`${u}-group`]:!0,[`${u}-multiple`]:this.multiple,[`${this.className}-dropdown`]:!!this.className}}},watch:{disabled(){this.dropdown&&(this.disabled?this.dropdown.disabled():this.dropdown.enabled())},"option.datas":function(){this.initCategoryDatas()},modelValue(){this.valueBak!=this.modelValue&&(this.parse(),this.tab=p,this.tabs=[{title:this.hlang("h.categoryModal.total"),key:p}],this.list=this.categoryDatas)}},mounted(){this.init(),this.initCategoryDatas()},methods:{init(){this.$nextTick(()=>{let e=this.el=this.$el.querySelector(".h-categorypicker-show");this.content=this.$el.querySelector(".h-categorypicker-group");let t=this;this.dropdown=new T(e,{trigger:"click",content:this.content,disabled:this.disabled,events:{show(){t.isShow=!0}}})})},refresh(){this.tab=p,this.tabs=[{title:this.hlang("h.categoryModal.total"),key:p}],this.initCategoryDatas()},remove(e){this.objects.splice(this.objects.indexOf(e),1),this.setvalue("remove")},clear(){this.object=null,this.setvalue("clear")},parse(){if(this.multiple){let e=[];if(a.isArray(this.modelValue)&&this.modelValue.length>0)for(let t of this.modelValue){let s=this.getValue(t);s&&e.push(s)}this.objects=e,this.object=null}else this.object=this.getValue(this.modelValue),this.objects=[]},getValue(e){return a.isNull(e)?null:this.type=="key"?this.categoryObj[e]:a.getValue(e,this.param)},getShow(e){return this.showAllLevels?(e=this.categoryObj[e.key]||e,this.getParentTitle(e).reverse().join("/")):e.title},getParentTitle(e){let t=[e.title];return e.parentKey!=null&&this.categoryObj[e.parentKey]&&t.push(...this.getParentTitle(this.categoryObj[e.parentKey])),t},getFullData(){if(this.multiple){let e=[];for(let t of this.objects){let s=this.categoryObj[t.key]||this.object;e.push(this.getParent(s))}return e}else if(this.object){let e=this.categoryObj[this.object.key]||this.object;return this.getParent(e)}return null},getParent(e){let t=[a.copy(e.value)];return e.parentKey!=null&&this.categoryObj[e.parentKey]&&t.push(...this.getParent(this.categoryObj[e.parentKey])),t},dispose(){return this.multiple?this.objects.map(e=>this.type=="key"?e.key:e.value).filter(e=>e!==void 0).map(e=>this.type=="key"?e:this.getDisposeValue(e)):this.object?this.type=="key"?this.object.key:this.getDisposeValue(this.object.value):null},getDisposeValue(e){let t=C({},e);return delete t[this.param.childrenName],t},setvalue(e){let t=this.dispose();this.$emit("input",t),this.$emit("update:modelValue",t),this.$emit("change",a.copy(this.multiple?this.objects:this.object)),e!="clear"&&(this.valueBak=t);let s=document.createEvent("CustomEvent");s.initCustomEvent("setvalue",!0,!0,t),this.$el.dispatchEvent(s),this.dropdownUpdate()},initCategoryDatas(){let e=[];if(a.isArray(this.param.datas)?e=this.param.datas:a.isFunction(this.param.datas)&&(e=this.param.datas.apply(this.param)),a.isFunction(this.param.getTotalDatas)||a.isFunction(this.param.getDatas)){e=[],this.globalloading=!0;let t=this.param.getTotalDatas||this.param.getDatas,s=[n=>{this.initDatas(a.copy(n)),this.globalloading=!1,this.$emit("loadDataSuccess")},()=>{this.globalloading=!1}];this.param.getDatas&&s.unshift(null),t.apply(this.param,s)}this.initDatas(e)},initDatas(e){let t=a.copy(e);this.param.dataMode=="list"&&e.length>0&&(t=a.generateTree(t,this.param));let s=a.isFunction(this.param.getDatas);this.categoryDatas=this.initTreeModeData(t,null,s,0),this.list=this.categoryDatas,this.parse()},initTreeModeData(e,t,s,n){let o=[];for(let i of e){let c={key:i[this.param.keyName],title:i[this.param.titleName],value:i,parentKey:t,status:{level:n,loading:!1,isWait:s,opened:!1,selected:!1,selectable:this.param.selectable?this.param.selectable(i,n):i.selectable!==!1,checkable:this.param.checkable?this.param.checkable(i,n):i.checkable!==!1}},f=i[this.param.childrenName]||[];c.children=this.initTreeModeData(f,c.key,s,n+1),this.categoryObj[c.key]=c,o.push(c)}return o},openNew(e,t){t&&(t.stopPropagation(),t.preventDefault()),e.children&&e.children.length?(this.tabIndex=this.tabIndex+1,this.tabs.splice(this.tabIndex),this.tabs.push(e),this.tab=e.key,this.list=e.children,this.multiple||this.change(e),this.dropdownUpdate()):e.status.isWait?(e.status.loading=!0,this.param.getDatas.call(this.param,e.value,s=>{e.children=this.initTreeModeData(s,e.key,!0,e.status.level+1),e.status.isWait=!1,e.status.loading=!1,e.status.opened=!0,this.openNew(e)},()=>{e.status.loading=!1})):this.change(e)},focusTab(e,t){this.tab=e.key,this.tabIndex=t,e.key===p?this.list=this.categoryDatas:this.list=e.children},change(e){if(!(!this.multiple&&e.status.selectable===!1)&&!(this.multiple&&e.status.checkable===!1)){if(this.multiple){if(this.objects.length>=this.limit&&!this.param.objects.some(t=>t.key===e.key)){S.error(this.hlang("h.categoryPicker.limitWords",{size:this.limit}));return}a.toggleValueByKey(this.objects,"key",e)}else this.object=e;this.multiple?this.dropdownUpdate():e.children&&e.children.length||this.dropdown.hide(),this.setvalue("picker")}},dropdownUpdate(){this.$nextTick(()=>{this.dropdown.update()})},isChecked(e){return this.multiple?this.objects.some(t=>t.key==e.key):this.object?this.object.key==e.key:!1}}},I=["disabled"],U={class:"h-categorypicker-show"},L={key:0,class:"h-categorypicker-multiple-tags"},z=["onClick"],W={key:1,class:"h-categorypicker-value-single"},q={key:2,class:"h-categorypicker-placeholder"},H={key:0,class:"h-icon-loading"},G=["onClick"],J={key:0};function Q(e,t,s,n,o,i){const c=w("Tabs"),f=w("Checkbox");return r(),h("div",{class:y(i.categoryCls),disabled:s.disabled},[d("div",U,[s.multiple&&o.objects.length?(r(),h("div",L,[(r(!0),h(D,null,V(o.objects,(l,m)=>(r(),h("span",{key:m+""+l.key},[d("span",null,g(i.getShow(l)),1),s.disabled?b("",!0):(r(),h("i",{key:0,class:"h-icon-close-min",onClick:_(R=>i.remove(l),["stop"])},null,8,z))]))),128))])):!s.multiple&&o.object?(r(),h("div",W,[d("span",null,g(i.getShow(o.object)),1),o.object&&!s.disabled?(r(),h("i",{key:0,class:"h-icon-close",onMousedown:t[0]||(t[0]=(...l)=>i.clear&&i.clear(...l))},null,32)):b("",!0)])):(r(),h("div",q,g(i.showPlaceholder),1))]),d("div",{class:y(i.groupCls)},[M(c,{modelValue:o.tab,"onUpdate:modelValue":t[1]||(t[1]=l=>o.tab=l),datas:o.tabs,class:"h-categorypicker-tabs","key-name":"key","title-name":"title",onChange:i.focusTab},null,8,["modelValue","datas","onChange"]),d("div",{class:y(["h-categorypicker-ul",{"h-categorypicker-single-picker":!s.multiple}])},[(r(!0),h(D,null,V(o.list,l=>(r(),h("div",{key:l.key,class:y(["h-categorypicker-item",{"h-categorypicker-item-selected":o.object&&l.key==o.object.key}])},[l.status.loading?(r(),h("i",H)):l.status.checkable&&s.multiple?(r(),K(f,{key:1,checked:i.isChecked(l),onChange:m=>i.change(l),onClick:t[2]||(t[2]=_(()=>{},["stop"]))},null,8,["checked","onChange"])):b("",!0),d("span",{class:"h-categorypicker-item-title",onClick:m=>i.openNew(l,m)},[E(g(l.title),1),s.showChildCount&&l.children.length?(r(),h("span",J,"("+g(l.children.length)+")",1)):b("",!0)],8,G)],2))),128))],2)],2)],10,I)}const ae=F(A,[["render",Q]]);export{ae as C};
