import y from"../utils/config.js";import{u as d}from"../utils.js";import D from"../plugins/dropdown.js";import j from"../mixins/locale.js";import{resolveComponent as _,openBlock as i,createElementBlock as l,normalizeClass as u,withDirectives as S,createElementVNode as n,createCommentVNode as m,toDisplayString as p,withModifiers as b,vShow as O,Fragment as f,createBlock as k,Transition as x,withCtx as N,renderList as v}from"vue";import{_ as C}from"../_plugin-vue_export-helper.js";import"../plugins/pop.js";import"../plugins/popper.js";import"../locale.js";import"../locale/lang/zh-CN.js";import"../locale/lang/en-US.js";import"../utils/format.js";const T={name:"HCascaderItem",emits:["trigger"],props:{data:Object,param:Object,multiple:Boolean,status:Object,level:Number},data(){return{}},methods:{clickShow(){this.selectOnClick&&this.select()},select(){(this.toggleOnSelect||this.multiple)&&this.toggleCascader(),!this.data.status.disabled&&(this.$emit("trigger",{type:"selectEvent",data:this.data}),this.multiple&&this.data.children.length==0&&(this.data.status.choose=!this.data.status.choose,this.choose()))},choose(){this.data.status.indeterminate=!1,this.$emit("trigger",{type:"chooseEvent",data:this.data})},trigger(e){if(e.type=="chooseEvent"&&this.chooseMode!="independent"&&this.data.children){let a=!0,t=!1;for(let o of this.data.children)!o.status.choose&&a&&(a=!1),o.status.choose&&(t=!0);this.chooseMode=="all"?(this.data.status.choose=a,this.data.status.indeterminate=t&&!a):this.chooseMode=="some"&&(this.data.status.choose=t,this.data.status.indeterminate=!1)}this.$emit("trigger",e)},toggleCascader(){this.data.status.isWait?this.loadData():this.$emit("trigger",{type:"toggleCascaderEvent",data:this.data})},loadData(){this.$emit("trigger",{type:"loadDataEvent",data:this.data})}}},E={key:1},M={key:2},B={class:"h-cascader-show-expand"},V={key:0,class:"h-icon-right"},I={key:1,class:"h-icon-loading"},F=n("i",{class:"h-icon-right"},null,-1),A=[F],W={class:"h-cascader-ul"};function q(e,a,t,o,c,s){const g=_("hCascaderItem");return i(),l("li",{class:u(["h-cascader-li",{"h-cascader-li-opened":t.data.status.opened}])},[S(n("div",{class:u(["h-cascader-show",{"h-cascader-show-disabled":t.data.status.disabled,"h-cascader-show-choose":t.data.status.choose,"h-cascader-show-selected":t.status.selected==t.data.key}]),onClick:a[3]||(a[3]=(...r)=>s.clickShow&&s.clickShow(...r))},[n("div",{class:u(["h-cascader-show-desc",{selected:t.status.selected==t.data.key}]),onClick:a[0]||(a[0]=(...r)=>s.select&&s.select(...r))},[t.data.icon?(i(),l("span",{key:0,class:u(["h-cascader-show-icon",t.data.icon])},null,2)):m("",!0),t.data.title!=null?(i(),l("span",E,p(t.data.title),1)):(i(),l("span",M,p(e.hlang("h.common.empty")),1))],2),n("span",B,[t.data.status.isWait?(i(),l("span",{key:0,onClick:a[1]||(a[1]=b(r=>s.toggleCascader(),["stop"]))},[t.data.status.loading?(i(),l("i",I)):(i(),l("i",V))])):t.data.children&&t.data.children.length>0?(i(),l("span",{key:1,onClick:a[2]||(a[2]=b(r=>s.toggleCascader(),["stop"]))},A)):m("",!0)])],2),[[O,!t.data.status.hide]]),t.data.children&&t.data.children.length>0?(i(),l(f,{key:0},[t.data.status.opened?(i(),k(x,{key:0,name:"h-cascader-transition"},{default:N(()=>[n("ul",W,[(i(!0),l(f,null,v(t.data.children,r=>(i(),k(g,{key:r.key,data:r,param:t.param,multiple:t.multiple,status:t.status,level:t.level+1,onTrigger:s.trigger},null,8,["data","param","multiple","status","level","onTrigger"]))),128))])]),_:1})):m("",!0)],64)):m("",!0)],2)}const z=C(T,[["render",q]]),h="h-cascader",H={name:"HCascader",components:{CascaderItem:z},emits:["input","change","loadDataSuccess"],mixins:[j],props:{option:Object,multiple:{type:Boolean,default:!1},type:{type:[String],default:"key"},disabled:{type:Boolean,default:!1},limit:Number,placeholder:{type:String},filterable:{type:Boolean,default:!0},value:[Number,String,Array,Object],config:String},data(){return{dropdown:null,globalloading:!1,loading:!0,objects:[],status:{selected:null},object:null,cascaderDatas:[],cascaderObj:{},searchValue:null}},computed:{showPlaceholder(){return this.placeholder||this.hlang("h.cascader.placeholder")},param(){return this.config?d.extend({},y.getOption("cascader.default"),y.getOption(`cascader.configs.${this.config}`),this.option):d.extend({},y.getOption("cascader.default"),this.option)},cascaderCls(){return{[`${h}`]:!0,[`${h}-input-border`]:!0,[`${h}-no-autosize`]:!0,[`${h}-multiple`]:this.multiple,[`${h}-disabled`]:this.disabled}},groupCls(){return{[`${h}-group`]:!0,[`${h}-multiple`]:this.multiple,[`${this.className}-dropdown`]:!!this.className}}},watch:{disabled(){this.dropdown&&(this.disabled?this.dropdown.disabled():this.dropdown.enabled())},"option.datas":function(){this.initCascaderDatas()}},mounted(){this.init(),this.initCascaderDatas()},methods:{init(){this.$nextTick(()=>{let e=this.el=this.$el.querySelector(".h-cascader-show");this.content=this.$el.querySelector(".h-cascader-group");let a=this;this.dropdown=new D(e,{trigger:"click",content:this.content,disabled:this.disabled,events:{show(){a.isShow=!0}}})})},trigger(e){},remove(e){this.objects.splice(this.objects.indexOf(e),1),this.setvalue()},clear(){this.object=null,this.setvalue()},parse(){if(this.multiple){let e=[];if(d.isArray(this.value)&&this.value.length>0)for(let a of this.value)e.push(this.getValue(a));this.objects=e}else this.object=this.getValue(this.value)},getValue(e){return d.isNull(e)?null:this.type=="key"?this.cascaderObj[e]:d.getValue(e,this.param)},dispose(){return this.multiple?this.objects.map(e=>this.type=="key"?e.key:e.value).filter(e=>e!==void 0):this.object?this.type=="key"?this.object.key:this.object.value:null},setvalue(){let e=this.dispose();this.$emit("input",e),this.$emit("change",d.copy(this.multiple?this.objects:this.object));let a=document.createEvent("CustomEvent");a.initCustomEvent("setvalue",!0,!0,e),this.$el.dispatchEvent(a)},initCascaderDatas(){let e=[];if(d.isArray(this.param.datas)?e=this.param.datas:d.isFunction(this.param.datas)&&(e=this.param.datas.apply(this.param)),d.isFunction(this.param.getTotalDatas)||d.isFunction(this.param.getDatas)){e=[],this.globalloading=!0;let a=this.param.getTotalDatas||this.param.getDatas,t=[o=>{this.cascaderDatas=this.initDatas(d.copy(o)),this.parse(),this.globalloading=!1,this.$emit("loadDataSuccess")},()=>{this.globalloading=!1}];this.param.getDatas&&t.unshift(null),a.apply(this.param,t)}this.cascaderDatas=this.initDatas(e),this.parse()},initDatas(e){let a=d.copy(e);this.param.dataMode=="list"&&e.length>0&&(a=d.generateTree(a,this.param));let t=d.isFunction(this.param.getDatas);return this.initTreeModeData(a,null,t)},initTreeModeData(e,a,t){let o=[];for(let c of e){let s={key:c[this.param.keyName],title:c[this.param.titleName],value:c,parentKey:a,status:{loading:!1,isWait:t,opened:!1,selected:!1,checkable:c.checkable!==!1}},g=c[this.param.childrenName]||[];s[this.param.childrenName]=this.initTreeModeData(g,s.key),this.cascaderObj[s.key]=s,o.push(s)}return o}}},L=["disabled"],P={class:"h-cascader-show"},G={key:0,class:"h-cascader-multiple-tags"},J=["onClick"],K={key:1,class:"h-cascader-value-single"},Q={key:2,class:"h-cascader-placeholder"},R={class:"h-cascader-ul"};function U(e,a,t,o,c,s){const g=_("CascaderItem");return i(),l("div",{class:u(s.cascaderCls),disabled:t.disabled},[n("div",P,[t.multiple&&c.objects.length?(i(),l("div",G,[(i(!0),l(f,null,v(c.objects,(r,w)=>(i(),l("span",{key:w+""+r.key},[n("span",null,p(r.title),1),t.disabled?m("",!0):(i(),l("i",{key:0,class:"h-icon-close-min",onClick:b(X=>s.remove(r),["stop"])},null,8,J))]))),128))])):!t.multiple&&c.object?(i(),l("div",K,[n("span",null,p(c.object.title),1),c.object&&!t.disabled?(i(),l("i",{key:0,class:"h-icon-close text-hover",onMousedown:a[0]||(a[0]=(...r)=>s.clear&&s.clear(...r))},null,32)):m("",!0)])):(i(),l("div",Q,p(s.showPlaceholder),1))]),n("div",{class:u(s.groupCls)},[n("ul",R,[(i(!0),l(f,null,v(c.cascaderDatas,r=>(i(),k(g,{key:r.key,data:r,param:s.param,multiple:t.multiple,status:c.status,level:0,onTrigger:s.trigger},null,8,["data","param","multiple","status","onTrigger"]))),128))])],2)],10,L)}const nt=C(H,[["render",U]]);export{nt as default};
