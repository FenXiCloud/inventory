import A from"../plugins/dropdown.js";import N from"../plugins/draggable.js";import{openBlock as d,createElementBlock as f,createElementVNode as a,normalizeStyle as g,resolveComponent as M,normalizeClass as V,createVNode as w,createBlock as O,createCommentVNode as S,Fragment as T,renderList as B,withDirectives as E,withKeys as H,vModelText as P,toDisplayString as v}from"vue";import{_ as F}from"../_plugin-vue_export-helper.js";import"../plugins/pop.js";import"../plugins/popper.js";import"../utils.js";const U=function(s){return typeof s=="string"&&s.indexOf(".")!==-1&&parseFloat(s)===1},D=function(s){return typeof s=="string"&&s.indexOf("%")!==-1},p=function(s,t){U(s)&&(s="100%");const o=D(s);return s=Math.min(t,Math.max(0,parseFloat(s))),o&&(s=parseInt(s*t,10)/100),Math.abs(s-t)<1e-6?1:s%t/parseFloat(t)},_={10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"},C=function({r:s,g:t,b:o}){const e=function(l){l=Math.min(Math.round(l),255);const r=Math.floor(l/16),i=l%16;return""+(_[r]||r)+(_[i]||i)};return isNaN(s)||isNaN(t)||isNaN(o)?"":"#"+e(s)+e(t)+e(o)},I=function(s,t,o){return C(m(s,t,o))},y={A:10,B:11,C:12,D:13,E:14,F:15},c=function(s){return s.length===2?(y[s[0].toUpperCase()]||+s[0])*16+(y[s[1].toUpperCase()]||+s[1]):y[s[1].toUpperCase()]||+s[1]},q=function(s,t,o){t=t/100,o=o/100;let e=t;const l=Math.max(o,.01);let r,i;return o*=2,t*=o<=1?o:2-o,e*=l<=1?l:2-l,i=(o+t)/2,r=o===0?2*e/(l+e):2*t/(o+t),{h:s,s:r*100,v:i*100}},X=function(s,t,o){return[s,t*o/((s=(2-t)*o)<1?s:2-s)||0,s/2]},x=function(s,t,o){s=p(s,255),t=p(t,255),o=p(o,255);const e=Math.max(s,t,o),l=Math.min(s,t,o);let r,i,h=e;const n=e-l;if(i=e===0?0:n/e,e===l)r=0;else{switch(e){case s:r=(t-o)/n+(t<o?6:0);break;case t:r=(o-s)/n+2;break;case o:r=(s-t)/n+4;break}r/=6}return{h:r*360,s:i*100,v:h*100}},m=function(s,t,o){s=p(s,360)*6,t=p(t,100),o=p(o,100);const e=Math.floor(s),l=s-e,r=o*(1-t),i=o*(1-l*t),h=o*(1-(1-l)*t),n=e%6,u=[o,i,r,r,h,o][n],b=[h,o,o,i,r,r][n],k=[r,r,h,o,o,i][n];return{r:Math.round(u*255),g:Math.round(b*255),b:Math.round(k*255)}};class j{constructor(t){this.hue=0,this.saturation=100,this.value=100,this.alpha=100,this.enableAlpha=!1,this.format="hex",this.string=t.string,t=t||{};for(let o in t)t.hasOwnProperty(o)&&(this[o]=t[o]);this.string&&this.calculate()}set(t,o){if(arguments.length===1&&typeof t=="object")for(let e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);else this[t]=o;this.calculate()}get(t){return this[t]}getHex(){return C(m(this.hue,this.saturation,this.value))}clear(){this.hue=0,this.saturation=100,this.alpha=100,this.value=100,this.string=null}parse(t){if(!t){this.clear();return}const o=(e,l,r)=>{this.hue=Math.max(0,Math.min(360,e)),this.saturation=Math.max(0,Math.min(100,l)),this.value=Math.max(0,Math.min(100,r)),this.calculate()};if(t.indexOf("hsl")!==-1){const e=t.replace(/hsla|hsl|\(|\)/gm,"").split(/\s|,/g).filter(l=>l!=="").map((l,r)=>r>2?parseFloat(l):parseInt(l,10));if(e.length===4?this.alpha=Math.floor(parseFloat(e[3])*100):e.length===3&&(this.alpha=100),e.length>=3){const{h:l,s:r,v:i}=q(e[0],e[1],e[2]);o(l,r,i)}}else if(t.indexOf("hsv")!==-1){const e=t.replace(/hsva|hsv|\(|\)/gm,"").split(/\s|,/g).filter(l=>l!=="").map((l,r)=>r>2?parseFloat(l):parseInt(l,10));e.length===4?this.alpha=Math.floor(parseFloat(e[3])*100):e.length===3&&(this.alpha=100),e.length>=3&&o(e[0],e[1],e[2])}else if(t.indexOf("rgb")!==-1){const e=t.replace(/rgba|rgb|\(|\)/gm,"").split(/\s|,/g).filter(l=>l!=="").map((l,r)=>r>2?parseFloat(l):parseInt(l,10));if(e.length===4?this.alpha=Math.floor(parseFloat(e[3])*100):e.length===3&&(this.alpha=100),e.length>=3){const{h:l,s:r,v:i}=x(e[0],e[1],e[2]);o(l,r,i)}}else if(t.indexOf("#")!==-1){const e=t.replace("#","").trim();if(!/^(?:[0-9a-fA-F]{3}){1,2}$/.test(e))return;let l,r,i;e.length===3?(l=c(e[0]+e[0]),r=c(e[1]+e[1]),i=c(e[2]+e[2])):(e.length===6||e.length===8)&&(l=c(e.substring(0,2)),r=c(e.substring(2,4)),i=c(e.substring(4,6))),e.length===8?this.alpha=Math.floor(c(e.substring(6))/255*100):(e.length===3||e.length===6)&&(this.alpha=100);const{h,s:n,v:u}=x(l,r,i);o(h,n,u)}}compare(t){return Math.abs(t.hue-this.hue)<2&&Math.abs(t.saturation-this.saturation)<1&&Math.abs(t.value-this.value)<1&&Math.abs(t.alpha-this.alpha)<1}calculate(){const{hue:t,saturation:o,value:e,alpha:l,format:r}=this;switch(r){case"hsl":const i=X(t,o/100,e/100);this.string=`hsl(${t}, ${Math.round(i[1]*100)}%, ${Math.round(i[2]*100)}%)`;break;case"hsv":this.string=`hsv(${t}, ${Math.round(o)}%, ${Math.round(e)}%)`;break;case"rgb":const{r:h,g:n,b:u}=m(t,o,e);this.string=`rgb(${h}, ${n}, ${u})`;break;default:if(this.enableAlpha){const{r:b,g:k,b:$}=m(t,o,e);this.string=`rgba(${b}, ${k}, ${$}, ${l/100})`}else this.string=C(m(t,o,e))}}toString(){return this.string}}const z={name:"HColorSlider",emits:["input","update:modelValue"],props:{modelValue:{type:Object,default:()=>({saturation:0,value:0})},hue:Number},data(){return{}},computed:{containerStyle(){return{background:I(this.hue,100,100)}}},mounted(){this.$nextTick(()=>{this.draggable=new N(this.$el.querySelector(".h-color-slider-node"),{start:this.setvalue,drag:this.setvalue,container:this.$el.querySelector(".h-color-slider-container")})})},beforeUnmount(){this.dropdown&&this.dropdown.destory()},methods:{setvalue(s){let t=this.$el.querySelector(".h-color-slider-container").getBoundingClientRect(),o=parseInt(Math.max(0,Math.min(s.clientX-t.left,t.width))*100/t.width),e=parseInt(Math.max(0,Math.min(s.clientY-t.top,t.height))*100/t.height);this.$emit("input",{saturation:o,value:e}),this.$emit("update:modelValue",{saturation:o,value:e})}}},K={class:"h-color-slider"},L=a("div",{class:"h-color-slider-bg-white"},null,-1),R=a("div",{class:"h-color-slider-bg-black"},null,-1);function Y(s,t,o,e,l,r){return d(),f("div",K,[a("div",{class:"h-color-slider-container",style:g(r.containerStyle)},[L,R,a("div",{class:"h-color-slider-node",style:g({left:`${o.modelValue.saturation}%`,top:`${o.modelValue.value}%`})},null,4)],4)])}const Z=F(z,[["render",Y]]),G={name:"HColorPicker",components:{ColorSlider:Z},emits:["input","change","update:modelValue"],props:{modelValue:String,disabled:{type:Boolean,default:!1},enableAlpha:{type:Boolean,default:!1},colorType:{type:String,default:"hex"},useConfirm:{type:Boolean,default:!1},colors:{type:Array,default:()=>[]}},data(){const s=new j({enableAlpha:this.enableAlpha,format:this.colorType,string:this.modelValue});return{color:s,colorValue:{saturation:s.saturation,value:100-s.value},dropdown:null,changed:!1}},computed:{alphaTrackStyle(){return this.modelValue||this.changed?{background:`linear-gradient(to right, rgba(255, 255, 255, 0) 0%, ${this.color.getHex()} 100%)`}:{}},bgColorStyle(){return this.modelValue||this.changed?{background:this.color.toString()}:{}}},watch:{disabled(){this.dropdown&&(this.disabled?this.dropdown.disabled():this.dropdown.enabled())},modelValue(){this.color.string!=this.modelValue&&this.reset()},colorType(){this.color.set("format",this.colorType)}},mounted(){this.init(),this.reset()},beforeUnmount(){this.dropdown&&this.dropdown.destory()},methods:{init(){this.$nextTick(()=>{let s=this.el=this.$el.querySelector(".h-colorpicker-show"),t=this.content=this.$el.querySelector(".h-colorpicker-group");this.dropdown=new A(s,{content:t,disabled:this.disabled,trigger:"click",events:{hide:()=>{this.useConfirm&&this.reset()}}})})},reset(){this.changed=!1,this.color.parse(this.modelValue),this.initColorValue()},initColorValue(){this.colorValue={saturation:this.color.saturation,value:100-this.color.value}},updateString(){this.color.parse(this.color.string)},calculate(){this.color.calculate(),this.changed=!0,this.useConfirm||this.setvalue(this.color.toString())},setvalue(s,{closeDropDown:t=!1}={}){this.$emit("input",s),this.$emit("change",s),this.$emit("update:modelValue",s),this.changed=!1;let o=document.createEvent("CustomEvent");o.initCustomEvent("setvalue",!0,!0,s),this.$el.dispatchEvent(o),this.dropdown&&(this.useConfirm||t)&&this.dropdown.hide()},confirm(){this.setvalue(this.color.toString()),this.dropdown&&this.dropdown.hide()},clear(){this.color.clear(),this.setvalue(null,{closeDropDown:!0})},updateColor(){this.color.set("saturation",this.colorValue.saturation),this.color.set("value",100-this.colorValue.value),this.calculate()},chooseColor(s){this.setvalue(s)}}},J={class:"h-colorpicker-show"},Q=a("div",{class:"h-colorpicker-color-bg"},null,-1),W=a("i",{class:"h-icon-down"},null,-1),tt={class:"h-colorpicker-group"},et={class:"h-colorpicker-panel-picker"},ot={key:1,class:"h-colorpicker-colors"},st=["onClick"],rt={class:"h-colorpicker-panel-footer"},lt={class:"h-colorpicker-panel-buttons"};function nt(s,t,o,e,l,r){const i=M("ColorSlider"),h=M("Slider");return d(),f("div",{class:V(["h-colorpicker",{"h-colorpicker-disabled":o.disabled}])},[a("div",J,[Q,a("div",{class:"h-colorpicker-color-show",style:g(r.bgColorStyle)},null,4),W]),a("div",tt,[a("div",et,[w(i,{modelValue:l.colorValue,"onUpdate:modelValue":[t[0]||(t[0]=n=>l.colorValue=n),r.updateColor],hue:l.color.hue},null,8,["modelValue","hue","onUpdate:modelValue"])]),w(h,{modelValue:l.color.hue,"onUpdate:modelValue":t[1]||(t[1]=n=>l.color.hue=n),class:"h-colorpicker-hue-picker",range:{start:0,end:360},showtip:!1,onChange:r.calculate},null,8,["modelValue","onChange"]),o.enableAlpha?(d(),O(h,{key:0,modelValue:l.color.alpha,"onUpdate:modelValue":t[2]||(t[2]=n=>l.color.alpha=n),"track-style":r.alphaTrackStyle,class:"h-colorpicker-alpha-picker",showtip:!1,onChange:r.calculate},null,8,["modelValue","track-style","onChange"])):S("",!0),o.colors.length?(d(),f("div",ot,[(d(!0),f(T,null,B(o.colors,n=>(d(),f("span",{key:n,class:V(["h-colorpicker-color",{"h-colorpicker-color-choosed":o.modelValue==n}]),style:g({background:n}),onClick:u=>r.chooseColor(n)},null,14,st))),128))])):S("",!0),a("div",rt,[E(a("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>l.color.string=n),type:"text",class:"h-input h-colorpicker-panel-input",onBlur:t[4]||(t[4]=(...n)=>r.updateString&&r.updateString(...n)),onKeydown:t[5]||(t[5]=H((...n)=>r.updateString&&r.updateString(...n),["enter"]))},null,544),[[P,l.color.string]]),a("div",lt,[a("button",{type:"button",class:"h-btn h-btn-s h-btn-text h-colorpicker-clear-button",onClick:t[6]||(t[6]=(...n)=>r.clear&&r.clear(...n))},v(s.hlang("h.common.clear")),1),a("button",{type:"button",class:"h-btn h-btn-s h-btn-primary",onClick:t[7]||(t[7]=(...n)=>r.confirm&&r.confirm(...n))},v(s.hlang("h.common.confirm")),1)])])])],2)}const ft=F(G,[["render",nt]]);export{ft as default};
