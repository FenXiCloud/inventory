import b from"./utils/config.js";import{u as m}from"./utils.js";import V from"./plugins/dropdown.js";import I from"./mixins/locale.js";import L from"./plugins/message.js";import{openBlock as h,createElementBlock as r,normalizeClass as p,createElementVNode as d,Fragment as u,renderList as S,toDisplayString as f,withModifiers as C,createCommentVNode as c,withDirectives as g,withKeys as O,vModelText as N,createTextVNode as k,renderSlot as y,vShow as v}from"vue";import{_}from"./_plugin-vue_export-helper.js";const a="h-select",H={name:"HSelect",mixins:[I],emits:["update:modelValue","change"],props:{multiple:{type:Boolean,default:!1},datas:[Array,Object],type:{type:[String],default:"key"},disabled:{type:Boolean,default:!1},dict:String,limit:{type:Number},deletable:{type:Boolean,default:()=>b.getOption("select.deletable")},noBorder:{type:Boolean,default:!1},placeholder:{type:String},emptyContent:{type:String},filterable:{type:Boolean,default:!1},filter:[Function,String,Array],autosize:{type:Boolean,default:!1},equalWidth:{type:Boolean,default:!0},keyName:{type:String,default:()=>b.getOption("dict","keyName")},titleName:{type:String,default:()=>b.getOption("dict","titleName")},optionRender:Function,modelValue:[Number,String,Array,Object],className:String},data(){return{html:"select_render_html",codes:[],label:null,objects:{},searchInput:"",nowSelected:-1,isShow:!1,content:null}},computed:{hasClose(){return this.deletable&&!this.multiple&&this.hasValue&&!this.disabled},hasValue(){return this.multiple?this.codes.length>0:!m.isNull(this.codes)&&this.objects},singleValue(){return this.hasValue?this.objects[this.titleName]:null},showEmptyContent(){return this.emptyContent||this.hlang("h.select.emptyContent")},hasLabel(){return this.options.some(e=>e.isLabel)},labels(){return this.multiple?[]:this.options.filter(e=>e.isLabel).map(e=>(e.children=this.getLabelOptions(e),e))},selectCls(){let e=this.autosize||!!this.noBorder;return{[`${a}`]:!0,[`${a}-input-border`]:!this.noBorder,[`${a}-input-no-border`]:this.noBorder,[`${a}-multiple`]:this.multiple,[`${a}-no-autosize`]:!e,[`${a}-disabled`]:this.disabled}},showCls(){return{[`${a}-show`]:!0,[`${this.className}-show`]:!!this.className}},groupCls(){return{[`${a}-group`]:!0,[`${a}-group-has-label`]:this.hasLabel,[`${a}-multiple`]:this.multiple,[`${a}-single`]:!this.multiple,[`${this.className}-dropdown`]:!!this.className}},optionsMap(){let e=m.toObject(this.options,this.keyName);return delete e.null,e},filterOptions(){if(this.searchInput){this.dropdown&&this.dropdown.update();let e=this.searchInput.toLowerCase();return this.options.filter(t=>{if(t.isLabel)return!0;if(this.filter){if(typeof this.filter=="function")return this.filter.call(this,t,e);if(typeof this.filter=="string")return!!this.filter.split(",").find(l=>t[l]&&t[l].toLowerCase().indexOf(e)!==-1);if(Array.isArray(this.filter))return!!this.filter.find(l=>t[l]&&t[l].toLowerCase().indexOf(e)!==-1)}return(t[this.html]||t[this.titleName]).toLowerCase().indexOf(e)!==-1})}return this.labels.length&&this.label?this.label.children:this.options},options(){if(!this.datas&&!this.dict)return console.error("[HeyUI Error] Select Component: Datas or dict parameters need to be defined at least."),[];let e=this.datas;return this.dict&&(e=b.getDict(this.dict)),e=b.initOptions(e,this),e}},watch:{datas(){this.parse()},modelValue(){this.parse()},disabled(){this.dropdown&&(this.disabled?this.dropdown.disabled():this.dropdown.enabled())},searchInput(){this.nowSelected=-1},nowSelected(){this.$nextTick(()=>{if(this.content&&this.nowSelected>-1){let e=this.content.querySelector(".h-select-item-picked"),t=this.content.querySelector(".h-select-list");e&&t&&(e.offsetTop+e.offsetHeight-t.scrollTop>t.offsetHeight?t.scrollTop=e.offsetTop+e.offsetHeight-t.offsetHeight:e.offsetTop-t.scrollTop<0&&(t.scrollTop=e.offsetTop))}})}},beforeMount(){this.parse()},beforeUnmount(){let e=this.el;e&&(e.style.display="none",this.$el.appendChild(e)),this.dropdown&&this.dropdown.destory()},mounted(){this.labels.length&&(this.label=this.labels[0]),this.$nextTick(()=>{let e=this.el=this.$el.querySelector(".h-select-show"),t=this.content=this.$el.querySelector(".h-select-group"),l=this;this.dropdown=new V(e,{content:t,disabled:this.disabled,equalWidth:this.equalWidth,trigger:"click foucs",triggerOnce:this.filterable||this.filter,events:{show:()=>{l.isShow=!0,this.codes&&!this.multiple&&this.labels.length&&(this.label=this.labels.find(o=>o.children.find(n=>this.isEqual(this.codes,n[this.keyName]))))}}})})},methods:{getLabelOptions(e){let t=this.options.findIndex(o=>o[this.titleName]===e[this.titleName]&&o.isLabel),l=[];for(let o=t+1;o<this.options.length;o++){let n=this.options[o];if(n.isLabel)break;l.push(n)}return l},changeLable(e){this.label=e},focusSearchInput(){this.$el.querySelector(".h-select-search-input").focus()},handle(e){let t=e.keyCode||e.which||e.charCode;t===38?this.nowSelected>0&&(this.nowSelected-=1):t===40?this.nowSelected<this.filterOptions.length-1&&(this.nowSelected+=1):e.code==="Enter"&&(this.nowSelected<0&&(this.nowSelected+=1),this.enterHandle(e))},enterHandle(e){e.preventDefault(),this.nowSelected>=0&&(this.setvalue(this.filterOptions[this.nowSelected],"enter"),this.multiple||e.target.blur())},blurHandle(){this.nowSelected=-1,setTimeout(()=>{this.searchInput=""},300)},search(e){this.searchInput=e},clear(){this.setvalue({[`${this.keyName}`]:null},"clear")},setObjects(){if(this.multiple){let e=[];for(let t of this.codes)this.optionsMap[t]!=null&&e.push(this.optionsMap[t]);this.objects=e}else this.objects=this.optionsMap[this.codes]},parse(){if(this.multiple){let e=this.modelValue||[];m.isArray(e)||(console.warn(`[HeyUI WARNING] Select Component: value '${e}' can't be a value of a multiple select`),e=[]),this.codes=e.map(t=>this.type=="key"?this.getValue(t):t[this.keyName]).filter(t=>t!==null)}else this.type=="key"?this.codes=this.getValue(this.modelValue):m.isObject(this.modelValue)?this.codes=this.modelValue[this.keyName]:this.codes=null;this.setObjects()},getValue(e){return m.isNull(e)?null:e},setvalue(e){if(this.disabled||e.disabled||e.isLabel)return;let t=e[this.keyName];if(this.multiple){if(!m.isNull(this.limit)&&!this.isIncludes(t)&&this.codes.length>=this.limit){L.error(this.hlang("h.select.limitSize",{limitSize:this.limit}));return}this.codes=m.toggleValue(this.codes,t)}else this.codes=t;this.setObjects();let l=this.type=="key"?this.codes:this.objects;this.$emit("update:modelValue",l),this.$emit("change",this.objects);let o=document.createEvent("CustomEvent");o.initCustomEvent("setvalue",!0,!0,this.objects),this.$el.dispatchEvent(o),this.nowSelected=-1,this.multiple?(this.searchInput="",this.$nextTick(()=>{this.dropdown.update()})):(this.dropdown.hide(),setTimeout(()=>{this.searchInput=""},100))},isIncludes(e){return this.codes.some(t=>this.isEqual(t,e))},isEqual(e,t){return e==t&&String(e)==String(t)},getLiCls(e,t){let l=e[this.keyName];return e.isLabel?{[`${a}-item-label`]:e.isLabel}:{[`${a}-item-disabled`]:e.disabled,[`${a}-item`]:!0,[`${a}-item-selected`]:this.multiple?this.isIncludes(l):this.isEqual(this.codes,l),[`${a}-item-picked`]:this.nowSelected===t}}}},T={class:"h-select-multiple-tags"},j=["onClick"],B=["disabled","placeholder"],E={key:0,class:"h-select-placeholder"},q=["disabled","placeholder"],x={key:0,class:"h-select-value-single"},M={key:1,class:"h-select-placeholder"},z={class:"h-icon-down"},A={key:0,class:"h-select-group-container"},D={class:"h-select-list"},U={style:{display:"flex"}},K={key:0,class:"h-select-ul h-select-ul-labels h-select-ul-scroll"},W=["onClick"],F=d("i",{class:"h-icon-right"},null,-1),R=["onClick"],G=["innerHTML"],J={key:3,class:"h-icon-check"},P={key:0,class:"h-select-ul-empty"};function Q(e,t,l,o,n,s){return h(),r("div",{class:p(s.selectCls)},[d("div",{class:p(s.showCls)},[l.multiple?(h(),r(u,{key:0},[d("div",T,[(h(!0),r(u,null,S(n.objects,i=>(h(),r("span",{key:i[l.keyName]},[d("span",null,f(i[l.titleName]),1),l.disabled?c("",!0):(h(),r("i",{key:0,class:"h-icon-close-min",onClick:C(w=>s.setvalue(i),["stop"])},null,8,j))]))),128)),l.filterable||l.filter?g((h(),r("input",{key:0,"onUpdate:modelValue":t[0]||(t[0]=i=>n.searchInput=i),type:"text",class:"h-select-search-input h-input",disabled:l.disabled,placeholder:l.placeholder,onKeyup:t[1]||(t[1]=(...i)=>s.handle&&s.handle(...i)),onBlur:t[2]||(t[2]=(...i)=>s.blurHandle&&s.blurHandle(...i)),onKeypress:t[3]||(t[3]=O((...i)=>s.enterHandle&&s.enterHandle(...i),["enter"]))},null,40,B)),[[N,n.searchInput]]):c("",!0)]),l.placeholder&&!s.hasValue&&!(l.filterable||l.filter)?(h(),r("div",E,f(l.placeholder),1)):c("",!0)],64)):(h(),r(u,{key:1},[l.filterable||l.filter?(h(),r(u,{key:0},[g(d("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>n.searchInput=i),type:"text",disabled:l.disabled,class:p([{"h-select-search-input-value":s.hasValue},"h-select-search-input h-select-single-search-input h-input"]),placeholder:s.hasValue?"":l.placeholder,onKeyup:t[5]||(t[5]=(...i)=>s.handle&&s.handle(...i)),onBlur:t[6]||(t[6]=(...i)=>s.blurHandle&&s.blurHandle(...i))},null,42,q),[[N,n.searchInput]]),s.hasValue&&n.searchInput===""?(h(),r("div",{key:0,class:"h-select-filterable-value",onClick:t[7]||(t[7]=(...i)=>s.focusSearchInput&&s.focusSearchInput(...i))},[e.$slots.show?y(e.$slots,"show",{key:1,value:n.objects}):(h(),r(u,{key:0},[k(f(s.singleValue),1)],64))])):c("",!0)],64)):(h(),r(u,{key:1},[s.hasValue?(h(),r("div",x,[e.$slots.show?y(e.$slots,"show",{key:1,value:n.objects}):(h(),r(u,{key:0},[k(f(s.singleValue),1)],64))])):(h(),r("div",M,f(l.placeholder),1))],64))],64)),g(d("i",{class:"h-icon-close text-hover",onClick:t[8]||(t[8]=C((...i)=>s.clear&&s.clear(...i),["stop"]))},null,512),[[v,s.hasClose]]),g(d("i",z,null,512),[[v,!s.hasClose]])],2),d("div",{class:p(s.groupCls)},[n.isShow?(h(),r("div",A,[d("div",D,[y(e.$slots,"top",{results:s.filterOptions}),d("div",U,[s.labels.length&&!n.searchInput&&!l.multiple?(h(),r("ul",K,[(h(!0),r(u,null,S(s.labels,i=>(h(),r("li",{class:p(["h-select-item",{"h-select-item-selected":n.label&&n.label[l.titleName]===i[l.titleName]}]),onClick:w=>s.changeLable(i)},[k(f(i[l.titleName])+" ",1),F],10,W))),256))])):c("",!0),d("ul",{style:{flex:"1"},class:p(["h-select-ul",{"h-select-ul-scroll":s.labels.length&&!n.searchInput&&!l.multiple}])},[(h(!0),r(u,null,S(s.filterOptions,(i,w)=>(h(),r(u,null,[i.hidden?c("",!0):(h(),r("li",{key:i[l.keyName],class:p(s.getLiCls(i,w)),onClick:X=>s.setvalue(i)},[l.optionRender?(h(),r("div",{key:0,innerHTML:i[n.html]},null,8,G)):e.$slots.item?y(e.$slots,"item",{key:2,item:i}):(h(),r(u,{key:1},[k(f(i[l.titleName]),1)],64)),l.multiple?(h(),r("i",J)):c("",!0)],10,R))],64))),256)),s.filterOptions.length==0?(h(),r("li",P,f(s.showEmptyContent),1)):c("",!0)],2)]),y(e.$slots,"bottom",{results:s.filterOptions})])])):c("",!0)],2)],2)}const ie=_(H,[["render",Q]]);export{ie as S};
