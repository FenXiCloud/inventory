{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\n/**\r\n * @功能描述: 商品FORM\r\n * @创建时间: 2024年05月06日\r\n * @公司官网: www.fenxi365.com\r\n * @公司信息: 纷析云（杭州）科技有限公司\r\n * @公司介绍: 专注于财务相关软件开发, 企业会计自动化解决方案\r\n */\nimport { confirm, message } from \"heyui.ext\";\nimport { CopyObj } from \"@common/utils\";\nimport Product from \"@js/api/Product\";\nimport ProductCategory from \"@js/api/ProductCategory\";\nimport CustomerLevel from \"@js/api/CustomerLevel\";\nimport Unit from \"@js/api/Unit\";\nimport { OssUpload } from \"@js/api/App\";\nexport default {\n  name: \"ProductForm\",\n  props: {\n    entity: Object\n  },\n  data() {\n    return {\n      loading: false,\n      categoryOption: {\n        keyName: 'id',\n        titleName: 'name',\n        dataMode: 'list',\n        parentName: 'pid',\n        datas: []\n      },\n      unitList: [],\n      customerLevel: [],\n      customerLevelPriceList: [],\n      model: {\n        id: null,\n        code: null,\n        name: null,\n        categoryId: null,\n        imgPath: null,\n        unitId: null,\n        enableMultiUnit: false,\n        multiUnit: [],\n        specification: null,\n        sort: 0,\n        remarks: null,\n        enabled: true\n      },\n      validationRules: {}\n    };\n  },\n  watch: {\n    'model.enableMultiUnit'(val) {\n      if (val) {\n        let multiUnit = [];\n        if (this.model.multiUnit) {\n          for (let i = 0; i < 2; i++) {\n            if (this.model.multiUnit[i]) {\n              multiUnit.push(this.model.multiUnit[i]);\n            } else {\n              multiUnit.push({\n                unitId: null,\n                unitName: null,\n                price: 0.0,\n                isDefault: false,\n                num: null\n              });\n            }\n          }\n          this.model.multiUnit = multiUnit;\n        } else if (!this.model.multiUnit || this.model.multiUnit.length === 0) {\n          multiUnit.push({\n            unitId: null,\n            unitName: null,\n            price: 0.0,\n            isDefault: false,\n            num: null\n          });\n          multiUnit.push({\n            unitId: null,\n            unitName: null,\n            price: 0.0,\n            isDefault: false,\n            num: null\n          });\n          this.model.multiUnit = multiUnit;\n        }\n      }\n    }\n  },\n  computed: {\n    unitName() {\n      if (this.model.unitId && this.unitList.length) {\n        return this.unitList.find(val => val.id === this.model.unitId).name;\n      }\n    }\n  },\n  methods: {\n    selectImg(e) {\n      let file = e.target.files[0];\n      if (!/\\.(jpg|jpeg|png|JPG|PNG)$/.test(e.target.value)) {\n        message.error('图片类型要求：jpeg、jpg、png');\n        return false;\n      }\n      if (file && file.size > 102400) {\n        e.target.value = '';\n        message.error(\"图片大于100KB\");\n        return false;\n      }\n      var reader = new FileReader(); //通过FileReader类型读取文件中的数据（异步文件读取）\n      reader.onload = function (e) {\n        var data = e.target.result; //返回文件框内上传的对象\n        //加载图片获取图片真实宽度和高度\n        var image = new Image();\n        image.onload = function () {\n          var width = image.width;\n          var height = image.height;\n          if (width !== height || width > 480) {\n            message.error(\"图片像素要相等，并且不能超过480\");\n            return false;\n          }\n          console.log('文件像素宽：' + width + '，文件像素高：' + height);\n        };\n        image.src = data;\n      };\n      reader.readAsDataURL(file);\n      const params = new FormData();\n      params.append('file', file);\n      OssUpload('goods', params).then(({\n        data\n      }) => {\n        if (data) {\n          this.model.imgPath = data;\n        }\n      });\n    },\n    save() {\n      let validResult = this.$refs.form.valid();\n      if (validResult.result) {\n        if (!this.model.enableMultiUnit) {\n          this.model.multiUnit = [];\n        } else {\n          let mus = [];\n          mus.push(this.model.unitId);\n          for (let i = 0; i < this.model.multiUnit.length; i++) {\n            let val = this.model.multiUnit[i];\n            if (val.unitId) {\n              val.unitName = this.getUnitName(val.unitId);\n              if (mus.includes(val.unitId)) {\n                message.error(val.unitName + \"单位不能一样~\");\n                return;\n              }\n            }\n          }\n          this.model.multiUnit = this.model.multiUnit.filter(val => val.unitId);\n        }\n        let checkPrice = false;\n        this.customerLevelPriceList.forEach(val => {\n          if (Number(val.price) === 0) {\n            checkPrice = true;\n          }\n          if (this.model.enableMultiUnit) {\n            this.model.multiUnit.forEach(mu => {\n              if (mu.unitId) {\n                if (Number(val[mu.unitId] || 0) === 0) {\n                  val[mu.unitId] = 0;\n                  checkPrice = true;\n                }\n              }\n            });\n          }\n        });\n        if (checkPrice) {\n          confirm({\n            title: \"系统提示\",\n            content: `检测到部分商品订货价为0，是否继续?`,\n            onConfirm: () => {\n              this.confirm();\n            }\n          });\n        } else {\n          this.confirm();\n        }\n      }\n    },\n    confirm() {\n      this.loading = true;\n      Product.save({\n        product: this.model,\n        levelPriceList: this.customerLevelPriceList\n      }).then(() => {\n        message(\"保存成功~\");\n        this.$emit('success');\n      }).finally(() => this.loading = false);\n    },\n    multiUnitChange(data) {\n      if (data) {\n        if (this.model.unitId === data.id) {\n          message.error(\"基础单位和辅助单位不能一致~\");\n        }\n        if (this.model.multiUnit.filter(val => val.unitId === data.id).length > 1) {\n          message.error(\"辅助单位不能一致~\");\n        }\n      }\n    },\n    getUnitName(unitId) {\n      if (unitId && this.unitList.length) {\n        return this.unitList.find(val => val.id === unitId).name;\n      }\n    }\n  },\n  created() {\n    Promise.all([ProductCategory.select(), Unit.select(), CustomerLevel.select()]).then(results => {\n      let categoryOptionList = results[0].data || [];\n      this.categoryOption.datas = categoryOptionList;\n      this.unitList = results[1].data;\n      if (this.entity) {\n        Product.levelPrice(this.entity.id).then(({\n          data\n        }) => {\n          let levelPrice = data;\n          if (results[2].data) {\n            let customLevelPriceList = [];\n            results[2].data.forEach(cl => {\n              let cp = {\n                customerLeveId: cl.id,\n                customerLeveName: cl.name,\n                price: 0\n              };\n              if (levelPrice) {\n                let lp = levelPrice[cl.id];\n                if (lp) {\n                  cp.price = lp.price;\n                  if (this.entity.enableMultiUnit) {\n                    lp.unitPrice.forEach(mu => {\n                      cp[mu.unitId] = mu.price || 0;\n                    });\n                  }\n                }\n              }\n              customLevelPriceList.push(cp);\n            });\n            console.log(customLevelPriceList);\n            this.customerLevelPriceList = customerLevelPriceList;\n          }\n        });\n      } else {\n        if (results[2].data) {\n          let customLevelPriceList = [];\n          results[2].data.forEach(cl => {\n            let cp = {\n              customerLeveId: cl.id,\n              customLeveName: cl.name,\n              price: 0\n            };\n            customerLevelPriceList.push(cp);\n          });\n          this.customerLevelPriceList = customerLevelPriceList;\n        }\n      }\n    }).finally(() => this.loading = false);\n    if (this.entity) {\n      CopyObj(this.model, this.entity);\n      if (this.model.enableMultiUnit) {\n        if (this.model.multiUnit && this.model.multiUnit.length > 0 && this.model.multiUnit.length < 3) {\n          let multiUnit = [];\n          let unitPrice = null;\n          for (let i = 0; i < 2; i++) {\n            if (this.model.multiUnit[i]) {\n              multiUnit.push(this.model.multiUnit[i]);\n            } else {\n              multiUnit.push({\n                unitId: null,\n                unitName: null,\n                price: 0.0,\n                isDefault: false,\n                num: null\n              });\n            }\n          }\n          if (unitPrice) {\n            multiUnit.push(unitPrice);\n          } else {\n            multiUnit.push({\n              unitId: null,\n              unitName: null,\n              price: 0.0,\n              isDefault: false,\n              num: null\n            });\n          }\n          this.model.multiUnit = multiUnit;\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["confirm","message","CopyObj","Product","ProductCategory","CustomerLevel","Unit","OssUpload","name","props","entity","Object","data","loading","categoryOption","keyName","titleName","dataMode","parentName","datas","unitList","customerLevel","customerLevelPriceList","model","id","code","categoryId","imgPath","unitId","enableMultiUnit","multiUnit","specification","sort","remarks","enabled","validationRules","watch","model.enableMultiUnit","val","i","push","unitName","price","isDefault","num","length","computed","find","methods","selectImg","e","file","target","files","test","value","error","size","reader","FileReader","onload","result","image","Image","width","height","console","log","src","readAsDataURL","params","FormData","append","then","save","validResult","$refs","form","valid","mus","getUnitName","includes","filter","checkPrice","forEach","Number","mu","title","content","onConfirm","product","levelPriceList","$emit","finally","multiUnitChange","created","Promise","all","select","results","categoryOptionList","levelPrice","customLevelPriceList","cl","cp","customerLeveId","customerLeveName","lp","unitPrice","customLeveName"],"sources":["D:\\DevWorks\\jxc\\merchant\\merchant-front\\src\\views\\basic\\ProductForm.vue"],"sourcesContent":["<template>\r\n  <div class=\"modal-column\" style=\"background: #f5f5f5\">\r\n    <div class=\"flex justify-between py-5px px-5px bg-white-color\">\r\n      <Button class=\"ml-10px\" @click=\"$emit('close')\" :loading=\"loading\">\r\n        取 消\r\n      </Button>\r\n      <Button class=\"mr-10px\" color=\"primary\" @click=\"save\" :loading=\"loading\">\r\n        保 存\r\n      </Button>\r\n    </div>\r\n    <div class=\"flex goods-form flex1\">\r\n      <div class=\"flex1\">\r\n        <div class=\"h-panel m-10px \">\r\n          <div class=\"flex p-8px border-bottom\">\r\n            <span class=\"font-bold\">商品信息</span>\r\n          </div>\r\n          <div class=\"flex pt-15px\">\r\n            <Form ref=\"form\" class=\"mr-10px\" :model=\"model\" :rules=\"validationRules\" mode=\"twocolumn\" :label-width=\"90\">\r\n              <FormItem label=\"商品编码\" prop=\"code\">\r\n                <Input placeholder=\"请输入编码,不填自动生成\" maxlength=\"64\" :disabled=\"model.id\" v-model=\"model.code\"/>\r\n              </FormItem>\r\n              <FormItem label=\"商品名称\" required prop=\"name\">\r\n                <Input placeholder=\"长度<64\" v-model=\"model.name\" maxlength=\"64\"/>\r\n              </FormItem>\r\n              <FormItem label=\"商品分类\" required prop=\"categoryId\">\r\n                <CategoryPicker :option=\"categoryOption\" type=\"key\" filterable v-model=\"model.categoryId\"></CategoryPicker>\r\n              </FormItem>\r\n              <FormItem label=\"规格\" required prop=\"specification\">\r\n                <Input placeholder=\"请输入规格\" v-model=\"model.specification\" maxlength=\"120\"/>\r\n              </FormItem>\r\n              <FormItem label=\"是否启用\" prop=\"enabled\">\r\n                <Radio v-model=\"model.enabled\" dict=\"statusRadios\"/>\r\n              </FormItem>\r\n              <FormItem label=\"排序号\" required prop=\"sort\">\r\n                <Input placeholder=\"请输入排序号\" v-model=\"model.sort\"/>\r\n              </FormItem>\r\n              <FormItem label=\"计量单位\" required prop=\"unitId\">\r\n                <div class=\"h-input-group\">\r\n                  <Select :datas=\"unitList\" keyName=\"id\" titleName=\"name\" :deletable=\"false\" v-model=\"model.unitId\" placeholder=\"基本单位\"/>\r\n                  <span class=\"h-input-addon\">  <Checkbox v-model=\"model.enableMultiUnit\" :trueValue=\"true\" :falseValue=\"false\">启用多单位</Checkbox></span>\r\n                </div>\r\n              </FormItem>\r\n              <template v-if=\"model.enableMultiUnit && model.unitId\">\r\n                <FormItem :label=\"`单位`+(index+1)\" v-for=\"(mu,index) in model.multiUnit\" :required=\"index===0\">\r\n                  <div class=\"h-input-group\">\r\n                    <Select :datas=\"unitList\" keyName=\"id\" v-model=\"mu.unitId\" @change=\"multiUnitChange\" filterable titleName=\"name\" :placeholder=\"`选择单位`+(index+1)\"/>\r\n                    <span class=\"ml-10px mr-10px\">=</span>\r\n                    <NumberInput type=\"number\" :min=\"0.01\" v-model.number=\"mu.num\"/>\r\n                    <span class=\"h-input-addon\">{{ unitName }}</span>\r\n                  </div>\r\n                </FormItem>\r\n              </template>\r\n              <FormItem label=\"商品描述\" prop=\"remarks\" single>\r\n                <Textarea v-wordcount=\"150\" rows=\"2\" placeholder=\"商品描述\" v-model=\"model.remarks\"/>\r\n              </FormItem>\r\n              <FormItem label=\"商品图片\" prop=\"imgPath\" single>\r\n                <div class=\"h-uploader-image-empty h-uploader-browse-button\" @click=\"$refs.uploads.click()\">\r\n                  <div class=\"h-uploader-image\" v-if=\"model.imgPath\">\r\n                    <img :src=\"model.imgPath\" v-if=\"model.imgPath\" style=\"height: 70px;width: 70px\" />\r\n                  </div>\r\n                  <i class=\"h-icon-plus\" v-else style=\"font-size: 25px; position: absolute;  top: 50%;  left: 50%; transform: translate(-50%,-50%);\"></i>\r\n                  <input type=\"file\" id=\"uploads\" style=\"position:absolute; clip:rect(0 0 0 0);\" ref=\"uploads\" accept=\"image/png, image/jpeg, image/gif, image/jpg\"\r\n                         @change=\"selectImg($event)\">\r\n                </div>\r\n              </FormItem>\r\n              <div style=\"clear: both\"></div>\r\n            </Form>\r\n          </div>\r\n        </div>\r\n        <div class=\"h-panel m-10px\">\r\n          <div class=\"flex p-8px border-bottom\">\r\n            <span class=\"font-bold\">客户级别定价</span>\r\n          </div>\r\n          <div style=\"height:calc(100vh - 665px); overflow-y:auto;\">\r\n            <vxe-table height=\"auto\" row-id=\"customerLeveId\" ref=\"tableCustomLevelPrice\" :data=\"customerLevelPriceList\"\r\n                       highlight-hover-row show-overflow border :row-config=\"{height: 48}\" >\r\n              <vxe-column title=\"客户级别\" field=\"customLeveName\" width=\"130\"/>\r\n              <vxe-column :title=\"`订货价${unitName?'('+unitName+')':''}`\" field=\"name\" align=\"right\">\r\n                <template #default=\"{ row }\">\r\n                  <Input class=\"tnumber\" type=\"text\" v-model.number=\"row.price\"/>\r\n                </template>\r\n              </vxe-column>\r\n              <template v-if=\" model.enableMultiUnit && model.multiUnit\">\r\n                <template v-for=\"mu in model.multiUnit\">\r\n                  <vxe-column :title=\"`订货价(${getUnitName(mu.unitId)})`\" v-if=\"mu.unitId\" :field=\"mu.unitId\" align=\"right\">\r\n                    <template #default=\"{ row }\">\r\n                      <Input class=\"tnumber\" type=\"text\" v-model.number=\"row[mu.unitId]\"/>\r\n                    </template>\r\n                  </vxe-column>\r\n                </template>\r\n              </template>\r\n            </vxe-table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <Loading text=\"运行中\" :loading=\"loading\"></Loading>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * @功能描述: 商品FORM\r\n * @创建时间: 2024年05月06日\r\n * @公司官网: www.fenxi365.com\r\n * @公司信息: 纷析云（杭州）科技有限公司\r\n * @公司介绍: 专注于财务相关软件开发, 企业会计自动化解决方案\r\n */\r\nimport {confirm, message} from \"heyui.ext\";\r\nimport {CopyObj} from \"@common/utils\";\r\nimport Product from \"@js/api/Product\";\r\nimport ProductCategory from \"@js/api/ProductCategory\";\r\nimport CustomerLevel from \"@js/api/CustomerLevel\";\r\nimport Unit from \"@js/api/Unit\";\r\nimport {OssUpload} from \"@js/api/App\";\r\n\r\nexport default {\r\n  name: \"ProductForm\",\r\n  props: {\r\n    entity: Object,\r\n  },\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      categoryOption: {\r\n        keyName: 'id',\r\n        titleName: 'name',\r\n        dataMode: 'list',\r\n        parentName: 'pid',\r\n        datas: []\r\n      },\r\n      unitList: [],\r\n      customerLevel: [],\r\n      customerLevelPriceList: [],\r\n      model: {\r\n        id: null,\r\n        code: null,\r\n        name: null,\r\n        categoryId: null,\r\n        imgPath: null,\r\n        unitId: null,\r\n        enableMultiUnit: false,\r\n        multiUnit: [],\r\n        specification: null,\r\n        sort: 0,\r\n        remarks: null,\r\n        enabled: true,\r\n      },\r\n      validationRules: {}\r\n    }\r\n  },\r\n  watch: {\r\n    'model.enableMultiUnit'(val) {\r\n      if (val) {\r\n        let multiUnit = [];\r\n        if (this.model.multiUnit) {\r\n          for (let i = 0; i < 2; i++) {\r\n            if (this.model.multiUnit[i]) {\r\n              multiUnit.push(this.model.multiUnit[i]);\r\n            } else {\r\n              multiUnit.push({unitId: null, unitName: null, price: 0.0, isDefault: false, num: null});\r\n            }\r\n          }\r\n          this.model.multiUnit = multiUnit;\r\n        } else if (!this.model.multiUnit || this.model.multiUnit.length === 0) {\r\n          multiUnit.push({unitId: null, unitName: null, price: 0.0, isDefault: false, num: null});\r\n          multiUnit.push({unitId: null, unitName: null, price: 0.0, isDefault: false, num: null});\r\n          this.model.multiUnit = multiUnit;\r\n        }\r\n      }\r\n    },\r\n  },\r\n  computed: {\r\n    unitName() {\r\n      if (this.model.unitId && this.unitList.length) {\r\n        return this.unitList.find(val => val.id === this.model.unitId).name;\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    selectImg(e) {\r\n      let file = e.target.files[0]\r\n      if (!/\\.(jpg|jpeg|png|JPG|PNG)$/.test(e.target.value)) {\r\n        message.error('图片类型要求：jpeg、jpg、png');\r\n        return false\r\n      }\r\n      if (file && file.size > 102400) {\r\n        e.target.value = '';\r\n        message.error(\"图片大于100KB\");\r\n        return false\r\n      }\r\n      var reader = new FileReader();  //通过FileReader类型读取文件中的数据（异步文件读取）\r\n      reader.onload = function (e) {\r\n        var data = e.target.result;  //返回文件框内上传的对象\r\n        //加载图片获取图片真实宽度和高度\r\n        var image = new Image();\r\n        image.onload = function () {\r\n          var width = image.width;\r\n          var height = image.height;\r\n          if (width !== height || width > 480) {\r\n            message.error(\"图片像素要相等，并且不能超过480\");\r\n            return false\r\n          }\r\n          console.log('文件像素宽：' + width + '，文件像素高：' + height);\r\n        };\r\n        image.src = data;\r\n      };\r\n\r\n      reader.readAsDataURL(file);\r\n\r\n      const params = new FormData()\r\n      params.append('file', file)\r\n\r\n      OssUpload('goods', params).then(({data}) => {\r\n        if (data) {\r\n          this.model.imgPath = data;\r\n        }\r\n      })\r\n    },\r\n    save() {\r\n      let validResult = this.$refs.form.valid();\r\n      if (validResult.result) {\r\n        if (!this.model.enableMultiUnit) {\r\n          this.model.multiUnit = [];\r\n        } else {\r\n          let mus = [];\r\n          mus.push(this.model.unitId);\r\n          for (let i = 0; i < this.model.multiUnit.length; i++) {\r\n            let val = this.model.multiUnit[i];\r\n            if (val.unitId) {\r\n              val.unitName = this.getUnitName(val.unitId);\r\n              if (mus.includes(val.unitId)) {\r\n                message.error(val.unitName + \"单位不能一样~\")\r\n                return;\r\n              }\r\n            }\r\n          }\r\n          this.model.multiUnit = this.model.multiUnit.filter(val => val.unitId);\r\n        }\r\n        let checkPrice = false;\r\n        this.customerLevelPriceList.forEach(val => {\r\n          if (Number(val.price) === 0) {\r\n            checkPrice = true;\r\n          }\r\n          if (this.model.enableMultiUnit) {\r\n            this.model.multiUnit.forEach(mu => {\r\n              if (mu.unitId ) {\r\n                if (Number(val[mu.unitId] || 0) === 0) {\r\n                  val[mu.unitId] = 0;\r\n                  checkPrice = true;\r\n                }\r\n              }\r\n            })\r\n          }\r\n        })\r\n        if (checkPrice) {\r\n          confirm({\r\n            title: \"系统提示\",\r\n            content: `检测到部分商品订货价为0，是否继续?`,\r\n            onConfirm: () => {\r\n              this.confirm();\r\n            }\r\n          })\r\n        } else {\r\n          this.confirm();\r\n        }\r\n      }\r\n    },\r\n    confirm() {\r\n      this.loading = true;\r\n      Product.save({product: this.model, levelPriceList: this.customerLevelPriceList}).then(() => {\r\n        message(\"保存成功~\");\r\n        this.$emit('success');\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    multiUnitChange(data) {\r\n      if (data) {\r\n        if (this.model.unitId === data.id) {\r\n          message.error(\"基础单位和辅助单位不能一致~\");\r\n        }\r\n        if (this.model.multiUnit.filter(val => val.unitId === data.id).length > 1) {\r\n          message.error(\"辅助单位不能一致~\");\r\n        }\r\n      }\r\n    },\r\n    getUnitName(unitId) {\r\n      if (unitId && this.unitList.length) {\r\n        return this.unitList.find(val => val.id === unitId).name;\r\n      }\r\n    },\r\n\r\n  },\r\n  created() {\r\n    Promise.all([\r\n      ProductCategory.select(),\r\n      Unit.select(),\r\n      CustomerLevel.select(),\r\n    ]).then((results) => {\r\n      let categoryOptionList = results[0].data || [];\r\n      this.categoryOption.datas = categoryOptionList;\r\n      this.unitList = results[1].data;\r\n      if (this.entity) {\r\n        Product.levelPrice(this.entity.id).then(({data}) => {\r\n          let levelPrice = data;\r\n          if (results[2].data) {\r\n            let customLevelPriceList = [];\r\n            results[2].data.forEach(cl => {\r\n              let cp = {customerLeveId: cl.id, customerLeveName: cl.name, price: 0};\r\n              if (levelPrice) {\r\n                let lp = levelPrice[cl.id];\r\n                if (lp) {\r\n                  cp.price = lp.price;\r\n                  if (this.entity.enableMultiUnit) {\r\n                    lp.unitPrice.forEach(mu => {\r\n                      cp[mu.unitId] = mu.price || 0;\r\n                    })\r\n                  }\r\n                }\r\n              }\r\n              customLevelPriceList.push(cp);\r\n            })\r\n            console.log(customLevelPriceList)\r\n            this.customerLevelPriceList = customerLevelPriceList;\r\n          }\r\n        })\r\n      } else {\r\n        if (results[2].data) {\r\n          let customLevelPriceList = [];\r\n          results[2].data.forEach(cl => {\r\n            let cp = {customerLeveId: cl.id, customLeveName: cl.name, price: 0};\r\n            customerLevelPriceList.push(cp);\r\n          })\r\n          this.customerLevelPriceList = customerLevelPriceList;\r\n        }\r\n      }\r\n\r\n    }).finally(() => this.loading = false);\r\n\r\n    if (this.entity) {\r\n      CopyObj(this.model, this.entity);\r\n      if (this.model.enableMultiUnit) {\r\n        if (this.model.multiUnit && this.model.multiUnit.length > 0 && this.model.multiUnit.length < 3) {\r\n          let multiUnit = []\r\n          let unitPrice = null\r\n          for (let i = 0; i < 2; i++) {\r\n            if (this.model.multiUnit[i]) {\r\n              multiUnit.push(this.model.multiUnit[i])\r\n            } else {\r\n              multiUnit.push({unitId: null, unitName: null, price: 0.0, isDefault: false, num: null});\r\n            }\r\n          }\r\n          if (unitPrice) {\r\n            multiUnit.push(unitPrice);\r\n          } else {\r\n            multiUnit.push({unitId: null, unitName: null, price: 0.0, isDefault: false, num: null});\r\n          }\r\n          this.model.multiUnit = multiUnit;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\">\r\n.goods-form .h-form .h-form-item {\r\n  padding-bottom: 15px !important;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}