{"ast":null,"code":"import \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport Role from \"@js/api/Role\";\nimport { message } from \"heyui.ext\";\nimport { mapState } from \"vuex\";\nimport Menu from \"@js/api/Menu\";\n\n/**\r\n * @功能描述: 授权菜单\r\n * @创建时间: 2023年08月08日\r\n * @公司官网: www.fenxi365.com\r\n * @公司信息: 纷析云（杭州）科技有限公司\r\n * @公司介绍: 专注于财务相关软件开发, 企业会计自动化解决方案\r\n */\nexport default {\n  name: \"GrantMenu\",\n  props: {\n    entity: Object\n  },\n  data() {\n    return {\n      loading: false,\n      dataList: [],\n      grantMenu: []\n    };\n  },\n  computed: {\n    ...mapState(['user'])\n  },\n  methods: {\n    checkBoxChange({\n      records\n    }) {\n      this.checkRequire();\n      this.loading = true;\n      let indeterminateRecords = this.$refs.table.getCheckboxIndeterminateRecords().map(val => val.id);\n      let menus = this.$refs.table.getCheckboxRecords().map(val => val.id).concat(indeterminateRecords);\n      this.loading = true;\n      Role.saveMenuRole(this.entity.id, menus).then(() => {\n        message(\"授权成功~\");\n      }).finally(() => this.loading = false);\n    },\n    checkRequire() {\n      this.grantMenu.forEach(id => {\n        let rowById = this.$refs.table.getRowById(id);\n        if (!rowById.children || !rowById.children.length) {\n          this.$refs.table.setCheckboxRow(rowById, true);\n        }\n      });\n    },\n    loadData() {\n      this.loading = true;\n      Promise.all([Menu.merchantMenu(\"MERCHANT\"), Role.getMenuRole(this.entity.id)]).then(results => {\n        this.dataList = results[0].data || [];\n        this.grantMenu = this.dataList.filter(val => !val.requireAuth).map(val => val.id);\n        this.$nextTick(() => {\n          if (results[1].data) {\n            results[1].data.forEach(id => {\n              let rowById = this.$refs.table.getRowById(id);\n              if (!rowById.children || !rowById.children.length) {\n                this.$refs.table.setCheckboxRow(rowById, true);\n              }\n            });\n          }\n        });\n      }).finally(() => this.loading = false);\n    },\n    checkMethod({\n      row\n    }) {\n      return row.requireAuth;\n    }\n  },\n  created() {\n    this.loadData();\n  }\n};","map":{"version":3,"names":["Role","message","mapState","Menu","name","props","entity","Object","data","loading","dataList","grantMenu","computed","methods","checkBoxChange","records","checkRequire","indeterminateRecords","$refs","table","getCheckboxIndeterminateRecords","map","val","id","menus","getCheckboxRecords","concat","saveMenuRole","then","finally","forEach","rowById","getRowById","children","length","setCheckboxRow","loadData","Promise","all","merchantMenu","getMenuRole","results","filter","requireAuth","$nextTick","checkMethod","row","created"],"sources":["D:\\DevWorks\\jxc\\merchant\\merchant-front\\src\\views\\setting\\GrantMenu.vue"],"sourcesContent":["<template>\r\n  <div style=\"display: flex;flex-direction: column;height: calc(100vh - 55px)\">\r\n    <div class=\"flex-1\">\r\n      <vxe-table row-id=\"id\"\r\n                 height=\"auto\"\r\n                 @checkbox-change=\"checkBoxChange\"\r\n                 @checkbox-all=\"checkBoxChange\"\r\n                 :checkbox-config=\"{labelField: 'name',checkMethod:checkMethod,checkRowKeys:grantMenu}\"\r\n                 :tree-config=\"{transform:true, expandAll:true, rowField: 'id', parentField: 'parentId'}\"\r\n                 ref=\"table\"\r\n                 :data=\"dataList\"\r\n                 highlight-hover-row\r\n                 :row-config=\"{useKey:true}\"\r\n                 :stripe=\"false\"\r\n                 :loading=\"loading\">\r\n        <vxe-column title=\"菜单分组\" width=\"100\" align=\"center\" field=\"menuGroup\"\r\n                    :formatter=\"({ cellValue })=>{return {MERCHANT:'集团菜单'}[cellValue]}\"/>\r\n        <vxe-column type=\"checkbox\" title=\"名称\" field=\"name\" tree-node/>\r\n      </vxe-table>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Role from \"@js/api/Role\";\r\nimport {message} from \"heyui.ext\";\r\nimport {mapState} from \"vuex\";\r\nimport Menu from \"@js/api/Menu\";\r\n\r\n/**\r\n * @功能描述: 授权菜单\r\n * @创建时间: 2023年08月08日\r\n * @公司官网: www.fenxi365.com\r\n * @公司信息: 纷析云（杭州）科技有限公司\r\n * @公司介绍: 专注于财务相关软件开发, 企业会计自动化解决方案\r\n */\r\nexport default {\r\n  name: \"GrantMenu\",\r\n  props: {\r\n    entity: Object,\r\n  },\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      dataList: [],\r\n      grantMenu: [],\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState(['user'])\r\n  },\r\n  methods: {\r\n    checkBoxChange({records}) {\r\n      this.checkRequire();\r\n      this.loading = true;\r\n      let indeterminateRecords = this.$refs.table.getCheckboxIndeterminateRecords().map(val => val.id);\r\n      let menus = this.$refs.table.getCheckboxRecords().map(val => val.id).concat(indeterminateRecords);\r\n\r\n      this.loading = true;\r\n      Role.saveMenuRole(this.entity.id, menus).then(() => {\r\n        message(\"授权成功~\");\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    checkRequire() {\r\n      this.grantMenu.forEach(id => {\r\n        let rowById = this.$refs.table.getRowById(id);\r\n        if (!rowById.children || !rowById.children.length) {\r\n          this.$refs.table.setCheckboxRow(rowById, true);\r\n        }\r\n      })\r\n    },\r\n    loadData() {\r\n      this.loading = true;\r\n      Promise.all([\r\n        Menu.merchantMenu(\"MERCHANT\"),\r\n        Role.getMenuRole(this.entity.id)\r\n      ]).then((results) => {\r\n        this.dataList = results[0].data || [];\r\n        this.grantMenu = this.dataList.filter(val => !val.requireAuth).map(val => val.id);\r\n\r\n        this.$nextTick(() => {\r\n          if (results[1].data) {\r\n            results[1].data.forEach(id => {\r\n              let rowById = this.$refs.table.getRowById(id);\r\n              if (!rowById.children || !rowById.children.length) {\r\n                this.$refs.table.setCheckboxRow(rowById, true);\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }).finally(() => this.loading = false);\r\n    },\r\n    checkMethod({row}) {\r\n      return row.requireAuth;\r\n    }\r\n  },\r\n  created() {\r\n    this.loadData();\r\n  }\r\n}\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}