{"ast":null,"code":"import \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\n/**\r\n * @功能描述: 组织机构Form\r\n * @创建时间: 2023年08月08日\r\n * @公司官网: www.fenxi365.com\r\n * @公司信息: 纷析云（杭州）科技有限公司\r\n * @公司介绍: 专注于财务相关软件开发, 企业会计自动化解决方案\r\n */\nimport ProductCategory from \"@js/api/ProductCategory\";\nimport { message } from \"heyui.ext\";\nimport { CopyObj } from \"@common/utils\";\nimport { OssUpload } from \"@js/api/App\";\nexport default {\n  name: \"ProductCategoryForm\",\n  emits: {\n    close: null,\n    success: null\n  },\n  props: {\n    productCategory: Object,\n    parent: Object,\n    list: Array\n  },\n  data() {\n    return {\n      loading: false,\n      categoryOption: {\n        keyName: 'id',\n        titleName: 'name',\n        dataMode: 'list',\n        parentName: 'pid',\n        datas: []\n      },\n      model: {\n        id: null,\n        code: null,\n        pid: null,\n        name: null,\n        imgPath: null,\n        path: null,\n        sort: 1\n      },\n      validationRules: {}\n    };\n  },\n  methods: {\n    confirm() {\n      let validResult = this.$refs.form.valid();\n      if (validResult.result) {\n        if (this.model.pid) {\n          let parent = this.list.find(c => c.id === this.model.pid);\n          this.model.path = (parent.path || '') + '/' + parent.id;\n        } else {\n          this.model.path = null;\n        }\n        if (this.model.id) {\n          if (this.model.id === this.model.pid) {\n            message.error(\"不能引用当前分类\");\n            return;\n          }\n        }\n        this.loading = true;\n        ProductCategory.save(this.model).then(() => {\n          message(\"保存成功~\");\n          this.$emit('success');\n        }).finally(() => this.loading = false);\n      }\n    },\n    selectImg(e) {\n      let file = e.target.files[0];\n      if (!/\\.(jpg|jpeg|png|JPG|PNG)$/.test(e.target.value)) {\n        message.error('图片类型要求：jpeg、jpg、png');\n        return false;\n      }\n      if (file && file.size > 102400) {\n        e.target.value = '';\n        message.error(\"图片大于100KB\");\n        return false;\n      }\n      var reader = new FileReader(); //通过FileReader类型读取文件中的数据（异步文件读取）\n      reader.onload = function (e) {\n        var data = e.target.result; //返回文件框内上传的对象\n        //加载图片获取图片真实宽度和高度\n        var image = new Image();\n        image.onload = function () {\n          var width = image.width;\n          var height = image.height;\n          if (width !== height || width > 480) {\n            message.error(\"图片像素要相等，并且不能超过480\");\n            return false;\n          }\n          console.log('文件像素宽：' + width + '，文件像素高：' + height);\n        };\n        image.src = data;\n      };\n      reader.readAsDataURL(file);\n      const params = new FormData();\n      params.append('file', file);\n      OssUpload('product', params).then(({\n        data\n      }) => {\n        if (data) {\n          this.model.imgPath = data;\n        }\n      });\n    }\n  },\n  created() {\n    this.categoryOption.datas = this.list || [];\n    CopyObj(this.model, this.productCategory);\n    if (this.parent) {\n      this.model.pid = this.parent.id;\n    }\n  }\n};","map":{"version":3,"names":["ProductCategory","message","CopyObj","OssUpload","name","emits","close","success","props","productCategory","Object","parent","list","Array","data","loading","categoryOption","keyName","titleName","dataMode","parentName","datas","model","id","code","pid","imgPath","path","sort","validationRules","methods","confirm","validResult","$refs","form","valid","result","find","c","error","save","then","$emit","finally","selectImg","e","file","target","files","test","value","size","reader","FileReader","onload","image","Image","width","height","console","log","src","readAsDataURL","params","FormData","append","created"],"sources":["D:\\DevWorks\\jxc\\merchant\\merchant-front\\src\\views\\basic\\ProductCategoryForm.vue"],"sourcesContent":["<template>\r\n  <div class=\"modal-column\">\r\n    <div class=\"modal-column-full-body\">\r\n      <Form ref=\"form\" :model=\"model\" :rules=\"validationRules\">\r\n        <FormItem label=\"编码\" required prop=\"code\">\r\n          <Input placeholder=\"请输入分类编码\" :disabled=\"model.id\" v-model=\"model.code\"/>\r\n        </FormItem>\r\n        <FormItem label=\"名称\" required prop=\"name\">\r\n          <Input placeholder=\"请输入分类名称\" v-model=\"model.name\"/>\r\n        </FormItem>\r\n        <FormItem label=\"排序\" required prop=\"sort\">\r\n          <Input placeholder=\"请输入排序\" v-model=\"model.sort\"/>\r\n        </FormItem>\r\n        <FormItem label=\"分类图片\" prop=\"imgPath\" single>\r\n          <div class=\"h-uploader-image-empty h-uploader-browse-button\" @click=\"$refs.uploads.click()\">\r\n            <div class=\"h-uploader-image\" v-if=\"model.imgPath\">\r\n              <img :src=\"model.imgPath\" v-if=\"model.imgPath\" style=\"height: 70px;width: 70px\"/>\r\n            </div>\r\n            <i class=\"h-icon-plus\" v-else style=\"font-size: 25px; position: absolute;  top: 50%;  left: 50%; transform: translate(-50%,-50%);\"></i>\r\n            <input type=\"file\" id=\"uploads\" style=\"position:absolute; clip:rect(0 0 0 0);\" ref=\"uploads\" accept=\"image/png, image/jpeg, image/gif, image/jpg\"\r\n                   @change=\"selectImg($event)\">\r\n          </div>\r\n        </FormItem>\r\n        <!--        <FormItem label=\"上级分类\" prop=\"parent\">-->\r\n        <!--          <CategoryPicker :option=\"categoryOption\" type=\"key\" v-model=\"model.pid\"></CategoryPicker>-->\r\n        <!--        </FormItem>-->\r\n      </Form>\r\n    </div>\r\n    <div class=\"modal-column-between\">\r\n      <Button @click=\"$emit('close')\" :loading=\"loading\">\r\n        取消\r\n      </Button>\r\n      <Button color=\"primary\" @click=\"confirm\" :loading=\"loading\">\r\n        保存\r\n      </Button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n/**\r\n * @功能描述: 组织机构Form\r\n * @创建时间: 2023年08月08日\r\n * @公司官网: www.fenxi365.com\r\n * @公司信息: 纷析云（杭州）科技有限公司\r\n * @公司介绍: 专注于财务相关软件开发, 企业会计自动化解决方案\r\n */\r\nimport ProductCategory from \"@js/api/ProductCategory\";\r\nimport {message} from \"heyui.ext\";\r\nimport {CopyObj} from \"@common/utils\";\r\nimport {OssUpload} from \"@js/api/App\";\r\n\r\nexport default {\r\n  name: \"ProductCategoryForm\",\r\n  emits: {\r\n    close: null,\r\n    success: null\r\n  },\r\n  props: {\r\n    productCategory: Object,\r\n    parent: Object,\r\n    list: Array,\r\n  },\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      categoryOption: {\r\n        keyName: 'id',\r\n        titleName: 'name',\r\n        dataMode: 'list',\r\n        parentName: 'pid',\r\n        datas: []\r\n      },\r\n      model: {\r\n        id: null,\r\n        code: null,\r\n        pid: null,\r\n        name: null,\r\n        imgPath: null,\r\n        path: null,\r\n        sort: 1,\r\n      },\r\n      validationRules: {}\r\n    }\r\n  },\r\n  methods: {\r\n    confirm() {\r\n      let validResult  = this.$refs.form.valid();\r\n      if (validResult.result) {\r\n\r\n        if (this.model.pid) {\r\n          let parent = this.list.find(c => c.id === this.model.pid);\r\n          this.model.path = (parent.path || '') + '/' + parent.id;\r\n        } else {\r\n          this.model.path = null;\r\n        }\r\n        if (this.model.id) {\r\n          if (this.model.id === this.model.pid) {\r\n            message.error(\"不能引用当前分类\")\r\n            return\r\n          }\r\n        }\r\n        this.loading = true;\r\n        ProductCategory.save(this.model).then(() => {\r\n          message(\"保存成功~\");\r\n          this.$emit('success');\r\n        }).finally(() => this.loading = false);\r\n      }\r\n    },\r\n    selectImg(e) {\r\n      let file = e.target.files[0]\r\n      if (!/\\.(jpg|jpeg|png|JPG|PNG)$/.test(e.target.value)) {\r\n        message.error('图片类型要求：jpeg、jpg、png');\r\n        return false\r\n      }\r\n      if (file && file.size > 102400) {\r\n        e.target.value = '';\r\n        message.error(\"图片大于100KB\");\r\n        return false\r\n      }\r\n      var reader = new FileReader();  //通过FileReader类型读取文件中的数据（异步文件读取）\r\n      reader.onload = function (e) {\r\n        var data = e.target.result;  //返回文件框内上传的对象\r\n        //加载图片获取图片真实宽度和高度\r\n        var image = new Image();\r\n        image.onload = function () {\r\n          var width = image.width;\r\n          var height = image.height;\r\n          if (width !== height || width > 480) {\r\n            message.error(\"图片像素要相等，并且不能超过480\");\r\n            return false\r\n          }\r\n          console.log('文件像素宽：' + width + '，文件像素高：' + height);\r\n        };\r\n        image.src = data;\r\n      };\r\n\r\n      reader.readAsDataURL(file);\r\n\r\n      const params = new FormData()\r\n      params.append('file', file)\r\n      OssUpload('product', params).then(({data}) => {\r\n        if (data) {\r\n          this.model.imgPath = data;\r\n        }\r\n      })\r\n    },\r\n  },\r\n  created() {\r\n    this.categoryOption.datas = this.list || [];\r\n    CopyObj(this.model, this.productCategory);\r\n    if (this.parent) {\r\n      this.model.pid = this.parent.id;\r\n    }\r\n  }\r\n}\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}