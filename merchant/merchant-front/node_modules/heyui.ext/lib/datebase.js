import s from"manba";import N from"./utils/config.js";import{u as d}from"./utils.js";import T from"./mixins/locale.js";import{openBlock as w,createElementBlock as f,createElementVNode as o,withModifiers as u,withDirectives as v,vShow as g,toDisplayString as c,createCommentVNode as k,normalizeClass as V,Fragment as O,renderList as _}from"vue";import{_ as M}from"./_plugin-vue_export-helper.js";const b="h-date",C=["year","month","date","hour","minute","second"],A=["year","month","week"],S=["year","quarter"],E=N.getOption("datepicker"),D={year:"year",month:"month",date:"date",week:"week",quarter:"quarter",datetime:"date",datehour:"date",time:"hour"},W={year:"year",month:"month",date:"date",week:"week",quarter:"quarter",datetime:"minute",datehour:"hour",time:"minute"},Y={year:10,month:10,date:10,week:10,quarter:10,hour:13,minute:16},y=i=>{let{date:e,type:t,show:a,vm:n,isNowDays:h,view:r}=i,m=!1;d.isObject(n.option)&&(n.option.start&&(m=e.distance(n.option.start,t)<0),n.option.end&&!m&&(m=e.distance(n.option.end,t)>0),n.option.disabled&&!m&&(m=n.option.disabled.call(null,e)));let p=e.distance(n.today,t),l=p==0;return r=="quarter"&&(l=p>=-2&&p<=0),{date:e,show:a,string:e.format(n.format),disabled:m,isToday:l,isNowDays:h}},x={name:"HDateBase",mixins:[T],emits:["updateValue","updateView","updateRangeEnd","changeValue","changeView"],props:{type:{type:[String],default:"date"},option:Object,format:String,value:[Object,String],nowView:Object,range:String,rangeEnd:String,startWeek:{type:Number,default:()=>N.getOption("datepicker.startWeek")}},data(){return{options:d.extend({},E.datetimeOptions,this.option),today:s(),view:D[this.type]}},computed:{valueTime(){return this.value?{start:this.value.start?s(this.value.start,this.format).time():null,end:this.value.end?s(this.value.end,this.format).time():null}:{start:null,end:null}},rangeEndTime(){return this.rangeEnd?s(this.rangeEnd,this.format).time():null},dateBodyCls(){return{[`${b}-body`]:!0,[`${b}-body-${this.view}`]:!0}},weeks(){let i=[this.hlang("h.date.weeks.monday"),this.hlang("h.date.weeks.tuesday"),this.hlang("h.date.weeks.wednesday"),this.hlang("h.date.weeks.thursday"),this.hlang("h.date.weeks.friday"),this.hlang("h.date.weeks.saturday"),this.hlang("h.date.weeks.sunday")],e=i.splice(0,this.startWeek-1);return i.push(...e),i},months(){return[this.hlang("h.date.months.january"),this.hlang("h.date.months.february"),this.hlang("h.date.months.march"),this.hlang("h.date.months.april"),this.hlang("h.date.months.may"),this.hlang("h.date.months.june"),this.hlang("h.date.months.july"),this.hlang("h.date.months.august"),this.hlang("h.date.months.september"),this.hlang("h.date.months.october"),this.hlang("h.date.months.november"),this.hlang("h.date.months.december")]},dates(){let i=this.nowView;if(this.view=="date"){let e=i.endOf(s.MONTH),t=i.startOf(s.MONTH),a=t.day();a==this.startWeek?a=-1:this.startWeek>a?a=7-(this.startWeek-a)-1:a=a-this.startWeek-1;let n=t.add(-1,s.DAY),h=[],r=n.date()-a;for(let l=r;l<=n.date();l++)h.push(y({date:s([n.year(),n.month(),l]),type:s.DAY,show:l,vm:this,isNowDays:!1}));for(let l=1;l<=e.date();l++)h.push(y({date:s([e.year(),e.month(),l]),type:s.DAY,show:l,vm:this,isNowDays:!0}));let m=e.add(1,s.DAY),p=7*6-h.length;for(let l=1;l<=p;l++)h.push(y({date:s([m.year(),m.month(),l]),type:s.DAY,show:l,vm:this,isNowDays:!1}));return h}else if(this.view=="month"){let e=[];for(let t=1;t<=12;t++)e.push(y({date:s([i.year(),t,1]),type:s.MONTH,show:this.months[t-1],vm:this,isNowDays:!0}));return e}else if(this.view=="year"){let e=[],t=i.year();for(let a=t-6;a<=t+5;a++)e.push(y({date:s([a,1,1]),type:s.YEAR,show:a,vm:this,isNowDays:!0}));return e}else if(this.view=="hour"){let e=[],t=[];d.isFunction(this.options.hours)?t=this.options.hours.call(null):t=d.numList(0,24,1);for(let a of t)e.push(y({date:s(i.time()).hours(a).minutes(0),type:s.HOUR,show:d.padLeft(a,2)+":00",vm:this,isNowDays:!0}));return e}else if(this.view=="minute"){let e=[],t=i.hours(),a=[];d.isFunction(this.options.minutes)?a=this.options.minutes.call(null,t):a=d.numList(0,60,this.options.minuteStep);for(let n of a)e.push(y({date:s(i.time()).minutes(n),type:s.MINUTE,show:d.padLeft(t,2)+":"+d.padLeft(n,2),vm:this,isNowDays:!0}));return e}else if(this.view=="week"){let e=[],t=s(i).add(-1,s.MONTH).endOf(s.MONTH).endOf(s.WEEK,this.startWeek),a=0;t.month()==i.month()?(t=t.startOf(s.WEEK,this.startWeek),a=1):t=t.add(7,s.DATE).startOf(s.WEEK,this.startWeek);let n=t.month(),h=a+n;for(h=h>12?1:h;t.month()==n||t.month()==h;)e.push(y({date:s(t.time()),type:s.WEEK,show:this.hlang("h.date.show.week",{year:t.year(),weeknum:t.getWeekOfYear(this.startWeek),daystart:t.format("MM-DD"),dayend:s(t).add(6).format("MM-DD")}),vm:this,isNowDays:!0})),t=t.add(7);return e}else if(this.view=="quarter"){let e=[],t=i.startOf(s.YEAR);for(let a=1;a<5;a++)e.push(y({date:s(t.time()),type:s.MONTH,show:this.hlang("h.date.show.quarter",{year:t.year(),quarter:a}),vm:this,isNowDays:!0,view:this.view})),t=t.add(3,s.MONTH);return e}return[]}},watch:{type(){this.options=d.extend({},E.datetimeOptions,this.option),this.view=D[this.type]}},mounted(){this.$nextTick(()=>{this.range&&(this.$el.addEventListener("mouseenter",i=>{if(this.view=="date"&&!!this.value.start&&!this.value.end){let e=i.target;if(e.tagName=="SPAN"){let t=e.getAttribute("string");t&&this.$emit("updateRangeEnd",t)}}},!0),this.$el.addEventListener("mouseout",()=>{this.view=="date"&&!!this.value.start&&!this.value.end&&this.$emit("updateRangeEnd","")},!0))})},methods:{hoursString(i){return`${d.padLeft(i.hours(),2)}:00`},changeView(i){this.view=i,this.$emit("changeView")},resetView(){this.view=D[this.type]},updateView(i,e){let t=s.DAY,a=s(this.nowView);i=="month"?(t=s.MONTH,a=a.startOf(s.MONTH)):i=="hour"?t=s.HOUR:(t=s.YEAR,this.view=="hour"?t=s.DAY:this.view=="minute"?t=s.DAY:this.view=="year"&&(e=e*12,t=s.YEAR)),a.add(e,t),this.$emit("updateView",a.time(),this.range)},getDateCls(i){let e=!1,t=!1,a=!1,n=!1,h=i.date.time();if(d.isObject(this.value))e=this.value.start==i.string,t=this.value.end==i.string;else{let r=Y[this.view];n=this.value.substring(0,r)==i.string.substring(0,r)}return this.range&&d.isObject(this.value)&&!!this.value.start&&!!this.rangeEnd&&(a=this.valueTime.start<h&&this.rangeEndTime>h||this.valueTime.start>h&&this.rangeEndTime<h),{"h-date-not-now-day":!i.isNowDays,"h-date-today":i.isToday,"h-date-selected":n||e||t,"h-date-range-selected":a,"h-date-start-selected":e,"h-date-end-selected":t,"h-date-disabled":i.disabled}},chooseDate(i){if(this.view==W[this.type])this.setvalue(i.date,!0);else{let e=i.date;if(!(this.view=="month"&&this.type!="month")&&!(this.view=="year"&&this.type!="year")){if(this.value){if(this.range)try{e=s(this.value[this.range])}catch(n){e=s(i.date)}else e=s(this.value);switch(this.view){case"minutes":e.minutes(i.date.minutes());break;case"hour":e.hours(i.date.hours());break;case"date":e.year(i.date.year()),e.month(i.date.month()),e.date(i.date.date());break;case"month":e.month(i.date.month()),e.month()>i.date.month()&&(e.date(1),e=e.add(-1,s.DAY));break;case"year":e.year(i.date.year());break}}this.options.start&&s(e).time()<s(this.options.start).time()&&(e=this.options.start),this.options.end&&s(e).time()>s(this.options.end).time()&&(e=this.options.end),this.range||this.setvalue(e,!1)}let t=C;this.type=="week"?t=A:this.type=="quarter"&&(t=S);let a=t.indexOf(this.view);this.view=t[a+1],this.$emit("updateView",s(e).time(),this.range)}},setvalue(i,e=!1){let t="";d.isNull(i)||(t=s(i).format(this.format)),this.$emit("updateValue",t,e,this.range)}}},q={class:"h-date-content"},H={key:0,class:"h-date-header"},L=o("i",{class:"h-icon-left"},null,-1),R=o("i",{class:"h-icon-left"},null,-1),j=[L,R],B=o("i",{class:"h-icon-left"},null,-1),K=[B],F={key:1,class:"h-date-header-show"},U=o("i",{class:"h-icon-right"},null,-1),z=o("i",{class:"h-icon-right"},null,-1),I=[U,z],J=o("i",{class:"h-icon-right"},null,-1),P=[J],G={class:"h-date-header"},Q=o("i",{class:"h-icon-left"},null,-1),X=[Q],Z=o("i",{class:"h-icon-right"},null,-1),$=[Z],ee={key:0,class:"h-date-body-weeks"},te={class:"h-date-body-pickers"},se=["string","onClick"];function ie(i,e,t,a,n,h){return w(),f("div",q,[t.type!="time"?(w(),f("div",H,[o("span",{class:"h-date-year-left-picker",onClick:e[0]||(e[0]=u(r=>h.updateView("default",-1),["stop"]))},j),v(o("span",{class:"h-date-month-left-picker",onClick:e[1]||(e[1]=u(r=>h.updateView("month",-1),["stop"]))},K,512),[[g,n.view=="date"||n.view=="week"]]),n.view!="year"?(w(),f("span",{key:0,class:"h-date-header-show",onClick:e[2]||(e[2]=u(r=>h.changeView("year"),["stop"]))},c(t.nowView.year()),1)):k("",!0),n.view=="year"?(w(),f("span",F,c(t.nowView.year()-6)+"\xA0\xA0-\xA0\xA0"+c(t.nowView.year()+5),1)):k("",!0),v(o("span",{class:"h-date-header-show",onClick:e[3]||(e[3]=u(r=>h.changeView("month"),["stop"]))},c(h.months[t.nowView.month()-1]),513),[[g,n.view!="year"&&n.view!="month"&&n.view!="quarter"]]),v(o("span",{class:"h-date-header-show",onClick:e[4]||(e[4]=u(r=>h.changeView("date"),["stop"]))},c(t.nowView.date()),513),[[g,n.view=="hour"||n.view=="minute"]]),o("span",{class:"h-date-year-right-picker",onClick:e[5]||(e[5]=u(r=>h.updateView("default",1),["stop"]))},I),v(o("span",{class:"h-date-month-right-picker",onClick:e[6]||(e[6]=u(r=>h.updateView("month",1),["stop"]))},P,512),[[g,n.view=="date"||n.view=="week"]])])):k("",!0),v(o("div",G,[o("span",{class:"h-date-month-left-picker",onClick:e[7]||(e[7]=u(r=>h.updateView("hour",-1),["stop"]))},X),o("span",{class:"h-date-header-show",onClick:e[8]||(e[8]=u(r=>h.changeView("hour"),["stop"]))},c(h.hoursString(t.nowView)),1),o("span",{class:"h-date-month-right-picker",onClick:e[9]||(e[9]=u(r=>h.updateView("hour",1),["stop"]))},$)],512),[[g,n.view=="minute"]]),o("div",{class:V(h.dateBodyCls)},[n.view=="date"?(w(),f("div",ee,[(w(!0),f(O,null,_(h.weeks,r=>(w(),f("span",{key:r},c(r),1))),128))])):k("",!0),o("div",te,[(w(!0),f(O,null,_(h.dates,r=>(w(),f("span",{key:r.string,string:r.string,class:V(h.getDateCls(r)),onClick:u(m=>h.chooseDate(r),["stop"])},c(r.show),11,se))),128))])],2)])}const de=M(x,[["render",ie]]);export{de as d};
