import o from"manba";import p from"./utils/config.js";import{u}from"./utils.js";import g from"./plugins/dropdown.js";import{d as D}from"./datebase.js";import b from"./mixins/locale.js";import{resolveComponent as w,openBlock as l,createElementBlock as h,normalizeClass as y,toDisplayString as c,createElementVNode as d,Fragment as C,renderList as N,createCommentVNode as T,createVNode as f,createTextVNode as O,createBlock as _}from"vue";import{_ as S}from"./_plugin-vue_export-helper.js";const m="h-datetime",M={name:"HDateFullRangePicker",components:{dateBase:D},emits:["change","update:modelValue","confirm","clear"],mixins:[b],props:{defaultType:{type:String,default:"week"},option:Object,placement:String,noBorder:{type:Boolean,default:!1},hasTime:{type:Boolean,default:!1},placeholder:{type:String},modelValue:Object,startWeek:{type:Number,default:()=>p.getOption("datepicker.startWeek")},layout:{type:Array,default:()=>["year","quarter","month","week","date","customize"]}},data(){let e=p.getOption("datepicker.format"),t=this.modelValue&&this.modelValue.type?this.modelValue.type:this.defaultType;return{allviews:{year:this.hlang("h.date.year"),quarter:this.hlang("h.date.quarter"),month:this.hlang("h.date.month"),week:this.hlang("h.date.week"),date:this.hlang("h.date.day"),customize:this.hlang("h.datepicker.customize")},nowFormat:this.hasTime?e.datetime:e.date,paramName:p.getOption("datepicker.daterangeOptions.paramName"),nowDate:{start:"",end:""},nowView:{start:o(),end:o().add(1,o.MONTH)},view:t,rangeEnd:"",isShow:!1}},computed:{views(){let e={};for(let t of this.layout)this.allviews[t]?e[t]=this.allviews[t]:console.warn(`[HeyUI WARNING] DateFullRangePicker Component: Props ${t} for layout don't exsits.`);return e},showPlaceholder(){return this.placeholder||this.hlang("h.datepicker.placeholder")},showValue(){if(!u.isObject(this.modelValue))return"";if(this.modelValue.type&&this.modelValue.start){let e=o(this.modelValue.start);switch(this.modelValue.type){case"year":return e.year();case"month":return e.format("YYYY-MM");case"quarter":return this.hlang("h.date.show.quarter",{year:e.year(),quarter:parseInt(e.month()/3,10)+1});case"week":return this.hlang("h.date.show.week",{year:e.year(),weeknum:e.getWeekOfYear(this.startWeek),daystart:e.format("MM-DD"),dayend:o(e).add(6).format("MM-DD")})}}return!this.modelValue.start&&!this.modelValue.end?"":`${this.modelValue.start||this.hlang("h.datepicker.start")} - ${this.modelValue.end?o(this.modelValue.end).add(-1).format(this.nowFormat):this.hlang("h.datepicker.end")}`},shortcuts(){let e=[],t=null;if(this.option&&this.option.shortcuts&&(t=this.option.shortcuts),u.isArray(t))for(let a of t)u.isString(a)?e.push(p.getOption("datepicker.shortcuts")[a]):u.isObject(a)&&e.push(a);return e},dateCls(){return{[`${m}`]:!0,[`${m}-full-range`]:!0,[`${m}-input-border`]:!this.noBorder}},datePickerCls(){return{[`${m}-has-shortcut`]:this.shortcuts.length>0}},startOption(){return this.option},endOption(){return this.option}},watch:{modelValue(){this.parse(this.modelValue)}},beforeMount(){this.parse(this.modelValue)},beforeUnmount(){let e=this.el;e&&(e.style.display="none",this.$el.appendChild(e)),this.dropdown&&this.dropdown.destory()},mounted(){let e=this;this.$nextTick(()=>{let t=this.el=this.$el.querySelector(`.${m}>.h-datetime-show`),a=this.$el.querySelector(".h-date-picker");this.dropdown=new g(t,{trigger:"click",content:a,placement:this.placement,events:{show(){e.isShow=!0,e.$nextTick(()=>{e.initNowView()})}}})})},methods:{setShortcutValue(e){let t=e.value.call(null);this.parse(t),this.updateValue(this.nowDate),this.hide()},changeView(){this.initNowView(),this.updateDropdown()},updateView(e){this.nowView.start=o(e),this.dropdown.update()},updateDropdown(){this.dropdown.update()},parseSingle(e,t){if(u.isObject(e)&&e[this.paramName[t]])try{let a=o(e[this.paramName[t]]);t=="end"&&(a=a.add(-1)),this.nowDate[t]=a.format(this.nowFormat);return}catch(a){console.error(a)}this.nowDate[t]=""},parse(e){this.modelValue&&this.modelValue.type&&(this.view=this.modelValue.type),this.parseSingle(e,"start"),this.parseSingle(e,"end")},initNowView(){let e=o();this.nowDate.start&&(e=o(this.nowDate.start));let t=o();this.nowDate.end&&(t=o(this.nowDate.end)),this.nowView={start:e,end:t}},hide(){this.dropdown.hide()},confirm(){this.$emit("confirm"),this.hide()},clear(){this.$emit("clear"),this.updateValue({}),this.initNowView(),this.hide()},setvalue(e,t=!1){if(e=e||"",this.view=="customize"){let s=u.copy(this.nowDate);s.end&&(s.end=o(s.end).add(1).format(this.nowFormat)),this.updateValue(s);return}let a={},n=o(e);this.view=="week"?a={start:n.format(),end:n.add(7).format()}:this.view=="year"?a={start:n.format(),end:n.add(1,o.YEAR).format()}:this.view=="month"?a={start:n.format(),end:n.add(1,o.MONTH).format()}:this.view=="quarter"?a={start:n.format(),end:n.add(3,o.MONTH).format()}:this.view=="date"&&(a={start:n.format(),end:n.add(1,o.DAY).format()}),a.start||(a.start=null),a.end||(a.end=null),this.updateValue(a),t&&this.hide()},updateValue(e){e={[this.paramName.start]:e.start,[this.paramName.end]:e.end,type:this.view},this.parse(e),this.$emit("update:modelValue",e),this.$emit("change",e);let t=document.createEvent("CustomEvent");t.initCustomEvent("setvalue",!0,!0,e),this.$el.dispatchEvent(t),this.dropdown.update()}}},P={key:0,class:"h-datetime-show text-hover"},q={key:1,class:"h-input h-datetime-show"},B=["value","placeholder"],U=d("i",{class:"h-icon-calendar"},null,-1),x={class:"h-date-container h-date-full-range-container"},E={key:0,class:"h-date-shortcut"},F=["onClick"],Y={key:1,class:"h-date-self-defined"},z={class:"h-date-footer"};function W(e,t,a,n,s,i){const k=w("Tabs"),V=w("DatePicker"),v=w("date-base");return l(),h("div",{class:y(i.dateCls)},[a.noBorder?(l(),h("div",P,c(i.showValue||a.placeholder),1)):(l(),h("div",q,[d("input",{type:"text",class:"h-input",value:i.showValue,readonly:"",placeholder:i.showPlaceholder},null,8,B),U])),d("div",{class:y([i.datePickerCls,"h-date-picker"])},[d("div",x,[i.shortcuts.length>0?(l(),h("div",E,[(l(!0),h(C,null,N(i.shortcuts,r=>(l(),h("div",{key:r.title,onClick:j=>i.setShortcutValue(r)},c(r.title),9,F))),128))])):T("",!0),d("div",null,[f(k,{modelValue:s.view,"onUpdate:modelValue":t[0]||(t[0]=r=>s.view=r),datas:i.views,onChange:i.changeView},null,8,["modelValue","datas","onChange"])]),s.view=="customize"?(l(),h("div",Y,[f(V,{modelValue:s.nowDate.start,"onUpdate:modelValue":t[1]||(t[1]=r=>s.nowDate.start=r),option:{end:s.nowDate.end},type:a.hasTime?"datetime":"date",placeholder:e.hlang("h.datepicker.startTime"),onChange:t[2]||(t[2]=r=>i.setvalue("start"))},null,8,["modelValue","option","type","placeholder"]),O(" - "),f(V,{modelValue:s.nowDate.end,"onUpdate:modelValue":t[3]||(t[3]=r=>s.nowDate.end=r),placement:"bottom-end",option:{start:s.nowDate.start},type:a.hasTime?"datetime":"date",placeholder:e.hlang("h.datepicker.endTime"),onChange:t[4]||(t[4]=r=>i.setvalue("end"))},null,8,["modelValue","option","type","placeholder"])])):(l(),_(v,{key:2,ref:"datebase",value:s.nowDate.start,option:a.option,type:s.view,"start-week":a.startWeek,"now-view":s.nowView.start,format:"k",onUpdateView:i.updateView,onUpdateValue:i.setvalue,onChangeView:i.updateDropdown},null,8,["value","option","type","start-week","now-view","onUpdateView","onUpdateValue","onChangeView"]))]),d("div",z,[d("button",{type:"button",class:"h-btn h-btn-text h-btn-s",onClick:t[5]||(t[5]=(...r)=>i.clear&&i.clear(...r))},c(e.hlang("h.common.clear")),1),d("button",{type:"button",class:"h-btn h-btn-primary h-btn-s",onClick:t[6]||(t[6]=(...r)=>i.confirm&&i.confirm(...r))},c(e.hlang("h.common.confirm")),1)])],2)],2)}const Q=S(M,[["render",W]]);export{Q as D};
