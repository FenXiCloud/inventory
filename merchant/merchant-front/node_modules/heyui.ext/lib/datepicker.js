import n from"manba";import p from"./utils/config.js";import{u as d}from"./utils.js";import k from"./plugins/dropdown.js";import{d as D}from"./datebase.js";import V from"./mixins/locale.js";import{resolveComponent as g,openBlock as l,createElementBlock as h,normalizeClass as y,Fragment as v,toDisplayString as c,withDirectives as S,createElementVNode as w,withKeys as C,vModelText as B,withModifiers as E,createCommentVNode as m,renderList as _,createVNode as x}from"vue";import{_ as O}from"./_plugin-vue_export-helper.js";const u="h-datetime",U={year:n.YEAR,month:n.MONTH,date:n.DAY,datetime:n.MINUTE,time:n.MINUTE,datehour:n.HOUR},f=p.getOption("datepicker"),N={name:"HDatePicker",components:{dateBase:D},mixins:[V],props:{disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},type:{type:[String],default:"date"},option:Object,format:String,noBorder:{type:Boolean,default:!1},hasSeconds:{type:Boolean,default:!1},placeholder:{type:String},hasButtons:{type:Boolean,default:!1},modelValue:String,inline:{type:Boolean,default:!1},placement:{type:String,default:"bottom-start"},startWeek:{type:Number,default:()=>p.getOption("datepicker.startWeek")},clearable:{type:Boolean,default:()=>p.getOption("datepicker.clearable")}},emits:["update:modelValue","change","confirm","clear"],data(){return{nowDate:"",showDate:"",nowView:n(),isShow:this.inline}},computed:{showPlaceholder(){return this.placeholder||this.hlang("h.datepicker.placeholder")},nowFormat(){let e=this.format;return e||(e=f.format[this.type],this.type=="datetime"&&this.hasSeconds&&(e=f.format.datetimesecond)),e},hasConfirm(){return this.type=="datetime"||this.type=="datehour"||this.hasButtons},shortcuts(){let e=[],i=null;if(this.option&&this.option.shortcuts&&(i=this.option.shortcuts),d.isArray(i))for(let t of i)d.isString(t)?e.push(f.shortcuts[t]):d.isObject(t)&&e.push(t);return e},dateCls(){return{[`${u}`]:!this.inline,[`${u}-inline`]:this.inline,[`${u}-input-border`]:!this.noBorder,[`${u}-disabled`]:this.disabled}},datePickerCls(){return{[`${u}-has-shortcut`]:this.shortcuts.length>0}}},watch:{modelValue(){this.initShowDate(this.modelValue)},disabled(){this.disabled?this.dropdown.disabled():this.dropdown.enabled()},type(){this.initShowDate(this.modelValue)}},beforeMount(){this.initShowDate(this.modelValue)},beforeUnmount(){let e=this.el;e&&(e.style.display="none",this.$el.appendChild(e)),this.dropdown&&this.dropdown.destory()},mounted(){let e=this;this.$nextTick(()=>{if(this.inline)return;let i=this.el=this.$el.querySelector(`.${u}>.h-datetime-show`),t=this.$el.querySelector(".h-date-picker");this.dropdown=new k(i,{trigger:"click",triggerOnce:!0,content:t,disabled:this.disabled,placement:this.placement,events:{show(){e.isShow=!0,e.$nextTick(()=>{e.initShowDate(e.modelValue),e.$refs.datebase.resetView(),e.nowDate&&(e.nowView=n(e.nowDate))})}}}),this.disabled&&this.dropdown.disabled()})},methods:{setShortcutValue(e){if(e.value&&d.isFunction(e.value)){let i=e.value.call(null);this.initShowDate(i),this.setvalue(this.nowDate)}this.hide()},clear(){this.$emit("clear"),this.setvalue(""),this.hide()},confirm(){this.$emit("confirm"),this.hide()},updateView(e){this.nowView=n(e),this.$nextTick(()=>{this.updateDropdown()})},updateDropdown(){this.dropdown&&this.dropdown.update()},inputEvent(e){let i=e.target.value;try{n(i)}catch(t){return}this.setvalue(i)},changeEvent(e){let i=e.target.value;if(this.initShowDate(i),this.nowDate&&d.isObject(this.option)&&this.type!="time"){let t=n(this.nowDate),r=U[this.type],a=!1;if(this.option.start&&t.distance(this.option.start,r)<0&&(a=!0),!a&&this.option.end&&t.distance(this.option.end,r)>0&&(a=!0),!a&&this.option.disabled&&this.option.disabled.call(null,t)&&(a=!0),a){this.resetValue();return}}this.setvalue(this.nowDate)},resetValue(){this.clear(),this.initShowDate()},initShowDate(e,i=!0){if(e!=""&&!d.isNull(e))try{this.nowView=n(e,this.nowFormat),this.nowDate=this.nowView.format("f"),i&&(this.type=="week"?this.showDate=this.hlang("h.date.show.weekInput",{year:this.nowView.year(),week:this.nowView.getWeekOfYear(this.startWeek)}):this.type=="quarter"?this.showDate=this.hlang("h.date.show.quarter",{year:this.nowView.year(),quarter:Math.ceil(this.nowView.month()/3)}):this.showDate=this.nowView.format(this.nowFormat));return}catch(t){console.error(t)}this.nowView=n(),this.nowDate="",i&&(this.showDate="")},hide(){this.dropdown&&this.dropdown.hide()},setvalue(e,i=!0){let t=e;e!=""&&(t=n(e).format(this.nowFormat)),this.$emit("update:modelValue",t),this.$emit("change",t);let r=document.createEvent("CustomEvent");r.initCustomEvent("setvalue",!0,!0,t),this.$el.dispatchEvent(r),i&&this.hide(),this.updateDropdown()}}},T={key:0,class:"h-datetime-show text-hover"},M={key:1,class:"h-input h-datetime-show"},P=["disabled","readonly","placeholder"],q={key:0,class:"h-icon-calendar"},F={key:0,class:"h-date-container"},W={key:0,class:"h-date-shortcut"},j=["onClick"],A={key:1,class:"h-date-footer"};function H(e,i,t,r,a,o){const b=g("date-base");return l(),h("div",{class:y(o.dateCls)},[t.inline?m("",!0):(l(),h(v,{key:0},[t.noBorder?(l(),h("div",T,c(a.showDate||o.showPlaceholder),1)):(l(),h("div",M,[S(w("input",{"onUpdate:modelValue":i[0]||(i[0]=s=>a.showDate=s),class:"h-input",type:"text",disabled:t.disabled,readonly:t.readonly||t.type=="week"||t.type=="quarter",placeholder:o.showPlaceholder,onChange:i[1]||(i[1]=(...s)=>o.changeEvent&&o.changeEvent(...s)),onKeydown:i[2]||(i[2]=C((...s)=>o.changeEvent&&o.changeEvent(...s),["enter"]))},null,40,P),[[B,a.showDate]]),!a.showDate||t.disabled||!t.clearable?(l(),h("i",q)):(l(),h("i",{key:1,class:"h-icon-close text-hover",onClick:i[3]||(i[3]=E((...s)=>o.clear&&o.clear(...s),["stop"]))}))]))],64)),w("div",{class:y([o.datePickerCls,"h-date-picker"])},[a.isShow?(l(),h("div",F,[o.shortcuts.length>0?(l(),h("div",W,[(l(!0),h(v,null,_(o.shortcuts,s=>(l(),h("div",{key:s.title,onClick:I=>o.setShortcutValue(s)},c(s.title),9,j))),128))])):m("",!0),x(b,{ref:"datebase",value:a.nowDate,option:t.option,type:t.type,"start-week":t.startWeek,"now-view":a.nowView,format:"k",onUpdateView:o.updateView,onUpdateValue:o.setvalue,onChangeView:o.updateDropdown},null,8,["value","option","type","start-week","now-view","onUpdateView","onUpdateValue","onChangeView"])])):m("",!0),o.hasConfirm&!t.inline?(l(),h("div",A,[w("button",{type:"button",class:"h-btn h-btn-text",onClick:i[4]||(i[4]=(...s)=>o.clear&&o.clear(...s))},c(e.hlang("h.common.clear")),1),w("button",{type:"button",class:"h-btn h-btn-primary h-btn-s",onClick:i[5]||(i[5]=(...s)=>o.hide&&o.hide(...s))},c(e.hlang("h.common.confirm")),1)])):m("",!0)],2)],2)}const X=O(N,[["render",H]]);export{X as D};
