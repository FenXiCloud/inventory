import i from"manba";import c from"./utils/config.js";import{u}from"./utils.js";import k from"./plugins/dropdown.js";import{d as b}from"./datebase.js";import y from"./mixins/locale.js";import{resolveComponent as _,openBlock as d,createElementBlock as h,normalizeClass as f,toDisplayString as p,createElementVNode as m,Fragment as v,renderList as C,createCommentVNode as V,createVNode as g}from"vue";import{_ as N}from"./_plugin-vue_export-helper.js";const l="h-datetime",D={name:"HDateRangePicker",components:{dateBase:b},mixins:[y],props:{disabled:{type:Boolean,default:!1},placement:String,type:{type:[String],default:"date"},option:Object,format:String,noBorder:{type:Boolean,default:!1},hasSeconds:{type:Boolean,default:!1},placeholder:{type:String},modelValue:Object,startWeek:{type:Number,default:()=>c.getOption("datepicker.startWeek")},bothChoose:{type:Boolean,default:!1}},emits:["update:modelValue","change","confirm","clear"],data(){return{paramName:c.getOption("datepicker.daterangeOptions.paramName"),nowDate:{start:"",end:""},nowView:{start:i(),end:i().add(1,i.MONTH)},rangeEnd:"",isShow:!1}},computed:{showPlaceholder(){return this.placeholder||this.hlang("h.datepicker.placeholder")},nowFormat(){let e=this.format||c.getOption("datepicker.format")[this.type];return this.type=="datetime"&&this.hasSeconds&&(e=c.getOption("datepicker.format.datetimesecond")),e},show(){return u.isObject(this.modelValue)?`${this.modelValue.start||this.hlang("h.datepicker.start")} - ${this.modelValue.end||this.hlang("h.datepicker.end")}`:""},shortcuts(){return this.option&&this.option.shortcuts||[]},dateCls(){return{[`${l}`]:!0,[`${l}-range`]:!0,[`${l}-input-border`]:!this.noBorder,[`${l}-disabled`]:this.disabled}},datePickerCls(){return{[`${l}-range-picker`]:!0,[`${l}-has-shortcut`]:this.shortcuts.length>0}},startOption(){return this.option},endOption(){return this.option}},watch:{modelValue(){this.parse(this.modelValue)},disabled(){this.disabled?this.dropdown.disabled():this.dropdown.enabled()}},beforeMount(){this.parse(this.modelValue)},beforeUnmount(){let e=this.el;e&&(e.style.display="none",this.$el.appendChild(e)),this.dropdown&&this.dropdown.destory()},mounted(){let e=this;this.$nextTick(()=>{let t=this.el=this.$el.querySelector(`.${l}>.h-datetime-show`),s=this.$el.querySelector(".h-date-picker");this.dropdown=new k(t,{trigger:"click",content:s,placement:this.placement,disabled:this.disabled,events:{show(){e.isShow=!0,e.$nextTick(()=>{e.initNowView()})},hide:()=>{this.hide()}}})})},methods:{updateRangeEnd(e){this.rangeEnd=e},setShortcutValue(e){let t=e.value.call(null);this.parse(t),this.updateValue(this.nowDate),this.confirm()},updateView(e,t){this.nowView[t]=i(e,this.nowFormat),this.nowView.start.time()>=this.nowView.end.time()&&(t=="end"?this.nowView.start=i(e,this.nowFormat).add(-1,i.MONTH):this.nowView.end=i(e,this.nowFormat).add(1,i.MONTH)),this.dropdown.update()},changeView(){this.dropdown.update()},parseSingle(e,t){if(u.isObject(e)&&e[this.paramName[t]])try{let s=i(e[this.paramName[t]],this.nowFormat);this.nowDate[t]=s.format(this.nowFormat);return}catch(s){}this.nowDate[t]=""},parse(e){this.parseSingle(e,"start"),this.parseSingle(e,"end"),this.rangeEnd=this.nowDate.end},initNowView(){let e=i();this.nowDate.start&&(e=i(this.nowDate.start,this.nowFormat));let t=1;this.nowView={start:e,end:i(e,this.nowFormat).add(t,i.MONTH)},this.$refs.start.resetView(),this.$refs.end.resetView()},confirm(){this.$emit("confirm"),this.hide()},hide(){this.dropdown.hide(),setTimeout(()=>{this.parseValue(this.modelValue)},400)},clear(){this.$emit("clear"),this.updateValue({}),this.initNowView(),this.hide()},setvalue(e,t=!1,s){e=e||"";let n=u.copy(this.nowDate);if(t?n.start?n.end?(n.start=e,n.end=""):n.end=e:n.start=e:s=="start"?n.start=e:s=="end"&&(n.end=e),t&&n.start&&n.end&&i(n.start,this.nowFormat).time()>i(n.end,this.nowFormat).time()){let r=n.start;n.start=n.end,n.end=r}if(this.bothChoose&&(!n.start||!n.end)){this.parseValue(n);return}this.updateValue(n)},parseValue(e){e={[this.paramName.start]:e.start,[this.paramName.end]:e.end},this.parse(e)},updateValue(e){e={[this.paramName.start]:e.start,[this.paramName.end]:e.end},this.parse(e),this.$emit("update:modelValue",e),this.$emit("change",e);let t=document.createEvent("CustomEvent");t.initCustomEvent("setvalue",!0,!0,e),this.$el.dispatchEvent(t),this.dropdown.update()}}},E={key:0,class:"h-datetime-show text-hover"},O={key:1,class:"h-input h-datetime-show"},S=["value","placeholder","disabled"],F=m("i",{class:"h-icon-calendar"},null,-1),U={key:0,class:"h-date-container h-date-range-container"},B={key:0,class:"h-date-shortcut"},R=["onClick"],x={class:"h-date-footer"};function P(e,t,s,n,r,a){const w=_("date-base");return d(),h("div",{class:f(a.dateCls)},[s.noBorder?(d(),h("div",E,p(e.showDate||a.showPlaceholder),1)):(d(),h("div",O,[m("input",{type:"text",class:"h-input",value:a.show,readonly:"",placeholder:a.showPlaceholder,disabled:s.disabled},null,8,S),F])),m("div",{class:f([a.datePickerCls,"h-date-picker"])},[r.isShow?(d(),h("div",U,[a.shortcuts.length>0?(d(),h("div",B,[(d(!0),h(v,null,C(a.shortcuts,o=>(d(),h("div",{key:o.title,onClick:T=>a.setShortcutValue(o)},p(o.title),9,R))),128))])):V("",!0),g(w,{ref:"start",value:r.nowDate,range:"start",option:a.startOption,type:s.type,"now-view":r.nowView.start,format:a.nowFormat,"start-week":s.startWeek,"range-end":r.rangeEnd,onUpdateView:a.updateView,onUpdateValue:a.setvalue,onChangeView:a.changeView,onUpdateRangeEnd:a.updateRangeEnd},null,8,["value","option","type","now-view","format","start-week","range-end","onUpdateView","onUpdateValue","onChangeView","onUpdateRangeEnd"]),g(w,{ref:"end",value:r.nowDate,range:"end",option:a.endOption,type:s.type,"now-view":r.nowView.end,format:a.nowFormat,"start-week":s.startWeek,"range-end":r.rangeEnd,onUpdateView:a.updateView,onUpdateValue:a.setvalue,onChangeView:a.changeView,onUpdateRangeEnd:a.updateRangeEnd},null,8,["value","option","type","now-view","format","start-week","range-end","onUpdateView","onUpdateValue","onChangeView","onUpdateRangeEnd"])])):V("",!0),m("div",x,[m("button",{type:"button",class:"h-btn h-btn-text h-btn-s",onClick:t[0]||(t[0]=(...o)=>a.clear&&a.clear(...o))},p(e.hlang("h.common.clear")),1),m("button",{type:"button",class:"h-btn h-btn-primary h-btn-s",onClick:t[1]||(t[1]=(...o)=>a.confirm&&a.confirm(...o))},p(e.hlang("h.common.confirm")),1)])],2)],2)}const G=N(D,[["render",P]]);export{G as D};
