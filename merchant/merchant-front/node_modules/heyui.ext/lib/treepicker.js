import d from"./utils/config.js";import{u as h}from"./utils.js";import g from"./plugins/dropdown.js";import{T as k}from"./tree.js";import{resolveComponent as y,openBlock as l,createElementBlock as o,normalizeClass as m,createElementVNode as a,Fragment as f,toDisplayString as c,renderList as v,withModifiers as j,createCommentVNode as p,createVNode as C}from"vue";import{_ as w}from"./_plugin-vue_export-helper.js";const u="h-treepicker",S={name:"HTreePicker",component:{Tree:k},emits:["select","choose","update:modelValue","change","input","loadDataSuccess"],props:{option:Object,multiple:{type:Boolean,default:!1},type:{type:[String],default:"key"},disabled:{type:Boolean,default:!1},limit:Number,placeholder:{type:String},filterable:{type:Boolean,default:!1},chooseMode:{type:String,default:"all"},showCount:{type:Boolean,default:!1},toggleOnSelect:{type:Boolean,default:!0},modelValue:[Number,String,Array,Object],config:String,className:String,useConfirm:{type:Boolean,default:!1}},data(){return{objects:[],object:null,dropdown:null,valuebak:null,stashObject:null}},computed:{param(){return this.config?h.extend({},d.getOption("tree.default"),d.getOption(`tree.configs.${this.config}`),this.option):h.extend({},d.getOption("tree.default"),this.option)},showCls(){return{[`${this.className}-show`]:!!this.className}},groupCls(){return{[`${this.className}-dropdown`]:!!this.className}},treepickerCls(){return{[`${u}`]:!0,[`${u}-input-border`]:!0,[`${u}-no-autosize`]:!0,[`${u}-multiple`]:this.multiple,[`${u}-disabled`]:this.disabled}}},watch:{modelValue(){this.parse()},disabled(){if(!this.dropdown)return!1;this.disabled?this.dropdown.disabled():this.dropdown.enabled()}},beforeUnmount(){let e=this.el;e&&(e.style.display="none",this.$el.appendChild(e)),this.dropdown&&this.dropdown.destory()},mounted(){this.parse(),this.$nextTick(()=>{if(this.inline)return;let e=this.el=this.$el.querySelector(`.${u}>.h-treepicker-show`),t=this.$el.querySelector(".h-treepicker-group");this.dropdown=new g(e,{trigger:"click",content:t,disabled:this.disabled}),this.disabled&&this.dropdown.disabled()})},methods:{refresh(){if(this.$refs.tree)return this.$refs.tree.refresh()},loadDataSuccess(){this.parse(),this.$emit("loadDataSuccess")},getChoose(){return this.$refs.tree?this.$refs.tree.getChoose():[]},getFullChoose(){return this.$refs.tree?this.$refs.tree.getFullChoose():[]},select(e){this.stashObject=e,!this.multiple&&!this.useConfirm&&this.confirm(e)},choose(e){this.objects=e,this.$emit("choose",e),this.multiple&&this.setvalue()},chooseAll(){this.$refs.tree&&this.$refs.tree.chooseAll()},remove(e){let t=this.objects.indexOf(e);this.objects.splice(t,1),this.valuebak.splice(t,1),this.setvalue(),this.triggerChange()},updateShow(e){h.isObject(e)&&!this.multiple&&(this.object=e),h.isArray(e)&&this.multiple&&(this.objects=e),this.setvalue()},parse(){this.type=="key"?(this.valuebak=h.copy(this.modelValue),this.$nextTick(()=>{this.multiple?this.objects=this.$refs.tree.getChoose():this.object=this.$refs.tree.getSelect()})):this.multiple?(this.valuebak=(this.modelValue||[]).map(e=>e[this.param.keyName]),this.objects=h.copy(this.modelValue)):(this.valuebak=this.modelValue?this.modelValue[this.param.keyName]:null,this.object=h.copy(this.modelValue))},dispose(){return this.multiple?this.objects.map(e=>this.type=="key"?e[this.param.keyName]:e).filter(e=>e!==void 0):this.object?this.type=="key"?this.object[this.param.keyName]:this.object:null},clear(){this.stashObject=null,this.objects=[],this.$refs.tree.searchTree(null),this.confirm()},confirm(){this.multiple||(this.object=this.stashObject,this.$emit("select",this.object)),this.setvalue(),this.triggerChange(),this.dropdown.hide()},setvalue(){let e=this.dispose();this.$emit("input",e),this.$emit("update:modelValue",e),this.stashObject=this.object;let t=document.createEvent("CustomEvent");t.initCustomEvent("setvalue",!0,!0,e),this.$el.dispatchEvent(t),this.$nextTick(()=>{this.dropdown&&this.dropdown.update()})},triggerChange(){this.$nextTick(()=>{this.$emit("change",h.copy(this.multiple?this.objects:this.object))})},expandAll(){if(this.$refs.tree)return this.$refs.tree.expandAll()},expand(e){if(this.$refs.tree)return this.$refs.tree.expand(e)},foldAll(){if(this.$refs.tree)return this.$refs.tree.foldAll()}}},_=["disabled"],N={key:0,class:"h-treepicker-value-single"},V={key:1,class:"h-treepicker-multiple-tags"},x=["onClick"],O={key:1,class:"h-treepicker-value-single"},T={key:2,class:"h-treepicker-placeholder"},$=a("i",{class:"h-icon-down"},null,-1),D={class:"h-treepicker-body"},A={key:0,class:"h-treepicker-footer"};function B(e,t,s,E,n,i){const b=y("Tree");return l(),o("div",{class:m(i.treepickerCls),disabled:s.disabled},[a("div",{class:m(["h-treepicker-show",i.showCls])},[s.multiple&&n.objects.length?(l(),o(f,{key:0},[s.showCount?(l(),o("div",N,c(e.hlang("h.treepicker.selectDesc",[n.valuebak.length])),1)):(l(),o("div",V,[(l(!0),o(f,null,v(n.objects,r=>(l(),o("span",{key:r[i.param.keyName]},[a("span",null,c(r[i.param.titleName]),1),s.disabled?p("",!0):(l(),o("i",{key:0,class:"h-icon-close-min",onClick:j(F=>i.remove(r),["stop"])},null,8,x))]))),128))]))],64)):!s.multiple&&n.object?(l(),o("div",O,c(n.object[i.param.titleName]),1)):(l(),o("div",T,c(s.placeholder),1)),$],2),a("div",{class:m(["h-treepicker-group",i.groupCls])},[a("div",D,[C(b,{ref:"tree",modelValue:n.valuebak,"onUpdate:modelValue":t[0]||(t[0]=r=>n.valuebak=r),"toggle-on-select":s.toggleOnSelect,option:s.option,multiple:s.multiple,"choose-mode":s.chooseMode,filterable:s.filterable,config:s.config,onLoadDataSuccess:i.loadDataSuccess,onSelect:i.select,onChoose:i.choose},null,8,["modelValue","toggle-on-select","option","multiple","choose-mode","filterable","config","onLoadDataSuccess","onSelect","onChoose"])]),s.multiple||s.useConfirm?(l(),o("div",A,[a("button",{type:"button",class:"h-btn h-btn-text h-btn-s",onClick:t[1]||(t[1]=(...r)=>i.clear&&i.clear(...r))},c(e.hlang("h.common.clear")),1),a("button",{type:"button",class:"h-btn h-btn-primary h-btn-s",onClick:t[2]||(t[2]=(...r)=>i.confirm&&i.confirm(...r))},c(e.hlang("h.common.confirm")),1)])):p("",!0)],2)],10,_)}const H=w(S,[["render",B]]);export{H as T};
