var P=Object.defineProperty,T=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var U=(l,e,t)=>e in l?P(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,k=(l,e)=>{for(var t in e||(e={}))A.call(e,t)&&U(l,t,e[t]);if(v)for(var t of v(e))O.call(e,t)&&U(l,t,e[t]);return l},C=(l,e)=>T(l,D(e));var w=(l,e,t)=>new Promise((h,c)=>{var s=n=>{try{i(t.next(n))}catch(u){c(u)}},m=n=>{try{i(t.throw(n))}catch(u){c(u)}},i=n=>n.done?h(n.value):Promise.resolve(n.value).then(s,m);i((t=t.apply(l,e)).next())});import{u as I}from"./utils.js";import N from"./mixins/locale.js";import E from"./plugins/image-preview.js";import z from"./plugins/message.js";import{resolveComponent as j,openBlock as r,createElementBlock as o,normalizeClass as y,Fragment as g,createElementVNode as a,normalizeStyle as b,createBlock as F,toDisplayString as f,createCommentVNode as d,renderList as S,withModifiers as _,renderSlot as V,withCtx as x,createTextVNode as G}from"vue";import{_ as M}from"./_plugin-vue_export-helper.js";const p={UPLOADING:"UPLOADING",SUCCESS:"SUCCESS",FAIL:"FAIL"},L=l=>({name:null,size:null,type:null,status:p.SUCCESS,url:l,thumbUrl:l,uid:I.uuid()}),B="h-uploader",W={name:"HUploader",mixins:[N],emits:["delete","click","update:modelValue"],props:{accept:String,buttonText:String,modelValue:{type:[Array,Object,String]},displayType:{type:String,default:"file"},dataType:{type:String,default:"object"},showFileList:{type:Boolean,default:!0},multiple:{type:Boolean,default:!1},limit:Number,readonly:{type:Boolean,default:!1},showPercent:{type:Boolean,default:!1},option:{type:Object,default:()=>{}}},data(){return{preview:!1,previewIndex:-1,isdragging:!1,stashFiles:[],stashValue:null}},watch:{modelValue(l){l!==this.stashValue&&(this.stashFiles=[])}},computed:{files(){return this.stashFiles.length?this.stashFiles:this.dataType==="url"?this.multiple?(this.modelValue||[]).map(l=>L(l)):this.modelValue?[L(this.modelValue)]:[]:this.multiple?this.modelValue||[]:this.modelValue?[this.modelValue]:[]},singleFile(){return this.files.length?this.files[0]:null},showUploadButton(){return this.readonly?!1:this.multiple&&(!this.limit||this.limit>this.files.length)||!this.multiple&&!this.files.length},showReUploadWord(){return this.hlang("h.uploader.reUpload")},showUploadWord(){return this.buttonText||this.hlang("h.uploader.upload")},showOverLimit(){return this.hlang("h.uploader.overLimit")},uploaderCls(){return{[B]:!0,[`${B}-${this.displayType}-container`]:!0}}},methods:{isUploading(l){return l.status===p.UPLOADING},triggerFileChoose(){this.$refs.file.value=null,this.$refs.file.click()},onDrag(l){this.isdragging=!1;var e=l.dataTransfer.files;this.onFileUpload(e)},onFileUpload(l){return w(this,null,function*(){if(l.length===0)return;if(this.multiple&&l.length+this.files.length>this.limit){z.error(this.showOverLimit);return}const e=[...l].filter(t=>!this.option.onBeforeUpload||this.option.onBeforeUpload(t)!==!1).map(t=>({name:t.name,size:t.size,type:t.type,status:p.UPLOADING,url:null,thumbUrl:null,uid:I.uuid(),file:t}));if(e.length!==0){this.multiple?this.stashFiles=[...this.files,...e]:this.stashFiles=[e[0]];for(const t of e)this.option.onChange&&this.option.onChange(t.file,t).then(h=>{this.update(C(k({},t),{status:p.SUCCESS,url:h}))}).catch(h=>{this.update(C(k({},t),{status:p.FAIL}))})}})},update(l){if(!l)return;const e=[...this.files],t=e.findIndex(h=>h.uid===l.uid);t>-1?l.status===p.FAIL?e.splice(t,1):e.splice(t,1,l):e.push(l),this.updateModelValue(e)},updateModelValue(l){this.stashFiles=l;let e=null;this.dataType==="url"?this.multiple?e=l.map(t=>t.url):e=l.length?l[0].url:[]:this.multiple?e=l:e=l.length?l[0]:null,this.stashValue=e,this.$emit("update:modelValue",e)},onFileChange(){const l=this.$refs.file.files;this.onFileUpload(l)},fileClick(l,e){this.$emit("click",l,e)},imageClick(l,e){this.$emit("click",e,l)},previewImage(l){E(this.files,l)},getBackgroundImage(l){let e={};return(l.thumbUrl||l.url)&&(e["background-image"]=`url(${l.thumbUrl||l.url})`),e},deleteFile(l,e){e&&e.stopPropagation(),this.$emit("delete",this.files[l],l);const t=[...this.files];t.splice(l,1),this.updateModelValue(t)}}},R={key:0,class:"h-uploader-image"},H={key:0,class:"h-uploader-progress"},q={key:1,class:"h-icon-spinner"},J=a("i",{class:"h-icon-plus"},null,-1),K=[J],Q=a("i",{class:"h-icon-plus"},null,-1),X=[Q],Y={key:0,class:"h-uploader-progress"},Z={key:1,class:"h-icon-spinner"},$=["onClick"],ee=["onClick"],le=a("i",{class:"h-icon-fullscreen"},null,-1),te=[le],se=a("i",{class:"h-space",style:{width:"5px"}},null,-1),ie=["onClick"],re=a("i",{class:"h-icon-trash"},null,-1),oe=[re],ae={key:2},ne={key:3,class:"h-uploader-files"},ue={key:0,class:"h-uploader-file-progress"},de={key:1,class:"h-uploader-file-loading"},he=a("i",{class:"h-icon-spinner"},null,-1),ge=["onClick"],ce={class:"link"},pe=["onClick"],me=["accept","multiple"];function fe(l,e,t,h,c,s){const m=j("Progress");return r(),o("div",{class:y(s.uploaderCls)},[t.displayType=="image"?(r(),o(g,{key:0},[t.multiple?(r(),o(g,{key:1},[s.showUploadButton?(r(),o("div",{key:0,class:"h-uploader-image-empty h-uploader-browse-button",onClick:e[2]||(e[2]=(...i)=>s.triggerFileChoose&&s.triggerFileChoose(...i))},X)):d("",!0),t.showFileList?(r(!0),o(g,{key:1},S(s.files,(i,n)=>(r(),o("div",{key:i.uid,class:y({"h-uploader-image":!0})},[a("div",{class:"h-uploader-image-background",style:b(s.getBackgroundImage(i))},null,4),s.isUploading(i)?(r(),o("div",Y,[t.showPercent?(r(),F(m,{key:0,percent:i.percent,"stroke-width":5},null,8,["percent"])):(r(),o("i",Z))])):(r(),o("div",{key:1,class:y({"h-uploader-image-operate":!0,"h-uploader-image-operate-pointer":t.readonly}),onClick:u=>s.imageClick(n,i)},[a("div",null,[a("span",{class:"h-uploader-operate",onClick:u=>s.previewImage(n)},te,8,ee),t.readonly?d("",!0):(r(),o(g,{key:0},[se,a("span",{class:"h-uploader-operate",onClick:u=>s.deleteFile(n,u)},oe,8,ie)],64))])],10,$))]))),128)):d("",!0)],64)):(r(),o(g,{key:0},[s.singleFile?(r(),o("div",R,[a("div",{class:"h-uploader-image-background",style:b(s.getBackgroundImage(s.singleFile))},null,4),s.isUploading(s.singleFile)?(r(),o("div",H,[t.showPercent?(r(),F(m,{key:0,percent:s.singleFile.percent,"stroke-width":5},null,8,["percent"])):(r(),o("i",q))])):(r(),o("div",{key:1,class:"h-uploader-image-operate h-uploader-browse-button",onClick:e[0]||(e[0]=(...i)=>s.triggerFileChoose&&s.triggerFileChoose(...i))},[a("div",null,f(s.showReUploadWord),1)]))])):s.showUploadButton?(r(),o("div",{key:1,class:"h-uploader-image-empty h-uploader-browse-button",onClick:e[1]||(e[1]=(...i)=>s.triggerFileChoose&&s.triggerFileChoose(...i))},K)):d("",!0)],64))],64)):d("",!0),t.displayType=="file"?(r(),o(g,{key:1},[l.$slots.dragdrop?(r(),o("div",{key:0,class:y(["h-uploader-browse-button h-uploader-drop-element",{"h-uploader-dragging":c.isdragging}]),onDragover:e[3]||(e[3]=_(i=>c.isdragging=!0,["prevent"])),onDragleave:e[4]||(e[4]=_(i=>c.isdragging=!1,["prevent"])),onDrop:e[5]||(e[5]=_((...i)=>s.onDrag&&s.onDrag(...i),["prevent","stop"])),onClick:e[6]||(e[6]=(...i)=>s.triggerFileChoose&&s.triggerFileChoose(...i))},[V(l.$slots,"dragdrop")],34)):l.$slots.button?(r(),o("div",{key:1,onClick:e[7]||(e[7]=(...i)=>s.triggerFileChoose&&s.triggerFileChoose(...i))},[V(l.$slots,"button")])):(r(),o("div",ae,[s.showUploadButton?(r(),o("button",{key:0,type:"button",icon:"h-icon-upload",class:"h-btn h-uploader-browse-button",onClick:e[8]||(e[8]=(...i)=>s.triggerFileChoose&&s.triggerFileChoose(...i))},f(s.showUploadWord),1)):d("",!0)])),t.showFileList?(r(),o("div",ne,[(r(!0),o(g,null,S(s.files,(i,n)=>(r(),o("div",{key:i.uid,class:"h-uploader-file"},[s.isUploading(i)?(r(),o("div",ue,[t.showPercent?(r(),F(m,{key:0,percent:i.percent,"stroke-width":5},{title:x(()=>[G(f(i.name),1)]),_:2},1032,["percent"])):(r(),o("div",de,[a("span",null,f(i.name),1),he]))])):(r(),o("div",{key:1,class:"h-uploader-file-info h-uploader-file-status-{{file.status}}",onClick:u=>s.fileClick(i,n)},[a("span",ce,f(i.name),1),t.readonly?d("",!0):(r(),o("i",{key:0,class:"h-icon-trash middle-right link",onClick:u=>s.deleteFile(n,u)},null,8,pe))],8,ge))]))),128))])):d("",!0)],64)):d("",!0),a("input",{ref:"file",type:"file",accept:t.accept,style:{display:"none"},multiple:t.multiple,onChange:e[9]||(e[9]=(...i)=>s.onFileChange&&s.onFileChange(...i))},null,40,me)],2)}const we=M(W,[["render",fe]]);export{we as U};
